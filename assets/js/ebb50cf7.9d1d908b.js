"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8847],{324:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"core-concepts/middleware","title":"Middleware","description":"Middleware in Balda are functions that have access to the request object, response object, and the next middleware function in the application\'s request-response cycle. They can execute code, modify the request and response objects, end the request-response cycle, and call the next middleware function.","source":"@site/docs/core-concepts/middleware.md","sourceDirName":"core-concepts","slug":"/core-concepts/middleware","permalink":"/balda/docs/core-concepts/middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/core-concepts/middleware.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"docs","previous":{"title":"Routing","permalink":"/balda/docs/core-concepts/routing"},"next":{"title":"Request & Response","permalink":"/balda/docs/core-concepts/request-response"}}');var d=r(4848),t=r(8453);const l={sidebar_position:4},a="Middleware",s={},o=[{value:"Basic Middleware",id:"basic-middleware",level:2},{value:"Function Signature",id:"function-signature",level:3},{value:"Simple Middleware Example",id:"simple-middleware-example",level:3},{value:"Middleware Application",id:"middleware-application",level:2},{value:"Global Middleware",id:"global-middleware",level:3},{value:"Controller-Level Middleware",id:"controller-level-middleware",level:3},{value:"Route-Level Middleware",id:"route-level-middleware",level:3},{value:"Common Middleware Patterns",id:"common-middleware-patterns",level:2},{value:"Authentication",id:"authentication",level:3},{value:"Role-Based Authorization",id:"role-based-authorization",level:3},{value:"Request Logging",id:"request-logging",level:3},{value:"Middleware Order",id:"middleware-order",level:2},{value:"Async Middleware",id:"async-middleware",level:2},{value:"Conditional Middleware",id:"conditional-middleware",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"middleware",children:"Middleware"})}),"\n",(0,d.jsx)(n.p,{children:"Middleware in Balda are functions that have access to the request object, response object, and the next middleware function in the application's request-response cycle. They can execute code, modify the request and response objects, end the request-response cycle, and call the next middleware function."}),"\n",(0,d.jsx)(n.h2,{id:"basic-middleware",children:"Basic Middleware"}),"\n",(0,d.jsx)(n.h3,{id:"function-signature",children:"Function Signature"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"type Middleware = (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => void | Promise<void>;\n"})}),"\n",(0,d.jsx)(n.h3,{id:"simple-middleware-example",children:"Simple Middleware Example"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const logger = (req, res, next) => {\n  console.log(`${req.method} ${req.url} - ${new Date().toISOString()}`);\n  next();\n};\n\nconst auth = (req, res, next) => {\n  const token = req.headers.authorization;\n\n  if (!token) {\n    return res.unauthorized({ error: 'Authentication required' });\n  }\n\n  // Verify token logic here\n  req.user = { id: 1, name: 'John' };\n  next();\n};\n"})}),"\n",(0,d.jsx)(n.h2,{id:"middleware-application",children:"Middleware Application"}),"\n",(0,d.jsx)(n.h3,{id:"global-middleware",children:"Global Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const server = new Server({ port: 3000 });\n\n// Single middleware\nserver.use(loggerMiddleware);\n\n// Multiple middleware\nserver.use(authMiddleware, loggingMiddleware);\n"})}),"\n",(0,d.jsx)(n.h3,{id:"controller-level-middleware",children:"Controller-Level Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"@controller('/users')\n@middleware(authMiddleware)\nexport class UsersController {\n  @get('/') getAll(req, res) { /* uses authMiddleware */ }\n\n  @get('/public')\n  @middleware(publicMiddleware) // Override\n  getPublic(req, res) { /* uses publicMiddleware instead */ }\n}\n"})}),"\n",(0,d.jsx)(n.h3,{id:"route-level-middleware",children:"Route-Level Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"// Direct registration\nserver.get('/admin', authMiddleware, (req, res) => res.json({ ok: true }));\n\n// Controller route\n@get('/admin', { middleware: [authMiddleware, adminMiddleware] })\ngetAdmin(req, res) { res.json({ users: [] }); }\n"})}),"\n",(0,d.jsx)(n.h2,{id:"common-middleware-patterns",children:"Common Middleware Patterns"}),"\n",(0,d.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const authMiddleware = async (req, res, next) => {\n  const token = req.headers.authorization?.replace('Bearer ', '');\n\n  if (!token) {\n    return res.unauthorized({ error: 'Token required' });\n  }\n\n  try {\n    req.user = jwt.verify(token, process.env.JWT_SECRET);\n    next();\n  } catch {\n    return res.unauthorized({ error: 'Invalid token' });\n  }\n};\n"})}),"\n",(0,d.jsx)(n.h3,{id:"role-based-authorization",children:"Role-Based Authorization"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const requireRole = (role) => (req, res, next) => {\n  if (!req.user || req.user.role !== role) {\n    return res.forbidden({ error: 'Insufficient permissions' });\n  }\n  next();\n};\n\n// Usage\n@get('/admin', { middleware: [authMiddleware, requireRole('admin')] })\ngetAdmin(req, res) { res.json({ admin: true }); }\n"})}),"\n",(0,d.jsx)(n.h3,{id:"request-logging",children:"Request Logging"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const logger = (req, res, next) => {\n  const start = Date.now();\n  res.on('finish', () => {\n    console.log(`${req.method} ${req.url} ${res.statusCode} - ${Date.now() - start}ms`);\n  });\n  next();\n};\n"})}),"\n",(0,d.jsxs)(n.admonition,{type:"tip",children:[(0,d.jsx)(n.p,{children:"For production use, leverage built-in plugins:"}),(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"cors"})," plugin for CORS handling"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"rateLimiter"})," plugin for rate limiting"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"log"})," plugin for request/response logging"]}),"\n"]}),(0,d.jsxs)(n.p,{children:["See ",(0,d.jsx)(n.a,{href:"../plugins/overview",children:"Plugins Overview"})," for details."]})]}),"\n",(0,d.jsx)(n.h2,{id:"middleware-order",children:"Middleware Order"}),"\n",(0,d.jsx)(n.p,{children:"Middleware executes in order: Global \u2192 Controller \u2192 Route \u2192 Handler"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"server.use(logger);                          // 1. Global\nserver.use(cors);                            // 2. Global\n\n@controller('/users')\n@middleware(authMiddleware)                  // 3. Controller\nexport class UsersController {\n  @get('/admin', { middleware: [adminMiddleware] }) // 4. Route\n  getAdmin(req, res) {                       // 5. Handler\n    // Execution: logger \u2192 cors \u2192 authMiddleware \u2192 adminMiddleware \u2192 handler\n  }\n}\n"})}),"\n",(0,d.jsx)(n.h2,{id:"async-middleware",children:"Async Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const asyncAuth = async (req, res, next) => {\n  try {\n    const user = await verifyToken(req.headers.authorization);\n    req.user = user;\n    next();\n  } catch {\n    return res.unauthorized({ error: 'Invalid token' });\n  }\n};\n"})}),"\n",(0,d.jsx)(n.h2,{id:"conditional-middleware",children:"Conditional Middleware"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-typescript",children:"const conditionalAuth = (req, res, next) => {\n  if (req.path.startsWith('/public')) {\n    return next(); // Skip auth for public routes\n  }\n\n  const token = req.headers.authorization;\n  if (!token) {\n    return res.unauthorized({ error: 'Authentication required' });\n  }\n\n  req.user = { id: 1 };\n  next();\n};\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>a});var i=r(6540);const d={},t=i.createContext(d);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);