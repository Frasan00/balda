"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9962],{3607:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"plugins/rate-limiter","title":"Rate Limiter Plugin","description":"Protects your application from abuse by limiting the number of requests a client can make within a specified time window. Supports both IP-based and custom key-based rate limiting.","source":"@site/docs/plugins/rate-limiter.md","sourceDirName":"plugins","slug":"/plugins/rate-limiter","permalink":"/balda/docs/plugins/rate-limiter","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/plugins/rate-limiter.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"docs","previous":{"title":"Helmet Plugin","permalink":"/balda/docs/plugins/helmet"},"next":{"title":"Compression","permalink":"/balda/docs/plugins/compression"}}');var s=i(4848),r=i(8453);const o={sidebar_position:7},a="Rate Limiter Plugin",l={},d=[{value:"Quick Start",id:"quick-start",level:2},{value:"Configuration",id:"configuration",level:2},{value:"IP-Based Limiting",id:"ip-based-limiting",level:3},{value:"Custom Key-Based Limiting",id:"custom-key-based-limiting",level:3},{value:"Storage Configuration",id:"storage-configuration",level:3},{value:"Usage",id:"usage",level:2},{value:"Global Rate Limiting",id:"global-rate-limiting",level:3},{value:"Route-Level Rate Limiting",id:"route-level-rate-limiting",level:3},{value:"Custom Key Function",id:"custom-key-function",level:3},{value:"Error Response",id:"error-response",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"API Endpoints",id:"api-endpoints",level:3},{value:"Authentication Endpoints",id:"authentication-endpoints",level:3},{value:"Public Endpoints",id:"public-endpoints",level:3},{value:"Sensitive Operations",id:"sensitive-operations",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Environment-Based Configuration",id:"environment-based-configuration",level:2},{value:"Custom Storage",id:"custom-storage",level:2},{value:"Best Practices",id:"best-practices",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"rate-limiter-plugin",children:"Rate Limiter Plugin"})}),"\n",(0,s.jsx)(n.p,{children:"Protects your application from abuse by limiting the number of requests a client can make within a specified time window. Supports both IP-based and custom key-based rate limiting."}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst server = new Server({\n  plugins: {\n    rateLimiter: {\n      keyOptions: {\n        limit: 100,\n        windowMs: 60000  // 1 minute\n      }\n    }\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"ip-based-limiting",children:"IP-Based Limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    limit: 100,                     // Requests per window\n    windowMs: 60000                 // Time window in ms (1 minute)\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"custom-key-based-limiting",children:"Custom Key-Based Limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    key: (req) => {\n      // Use API key or user ID as rate limit key\n      return req.headers.get('X-API-Key') || req.ip;\n    },\n    limit: 50,\n    windowMs: 60000\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"storage-configuration",children:"Storage Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'rateLimiter: {\n  keyOptions: {\n    limit: 100,\n    windowMs: 60000,\n    storageStrategy: "memory"  // Default: in-memory storage\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.h3,{id:"global-rate-limiting",children:"Global Rate Limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const server = new Server({\n  plugins: {\n    rateLimiter: {\n      keyOptions: {\n        limit: 100,\n        windowMs: 60000  // 100 requests per minute\n      }\n    }\n  }\n});\n\n@controller('/api')\nexport class ApiController {\n  @get('/users')\n  async getUsers(req: Request, res: Response) {\n    // Rate limited to 100 requests per minute per IP\n    const users = await getUsers();\n    res.json(users);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"route-level-rate-limiting",children:"Route-Level Rate Limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { rateLimiter } from 'balda';\n\n@controller('/api')\nexport class ApiController {\n  @get('/public', {\n    middleware: [rateLimiter({\n      keyOptions: {\n        limit: 1000,\n        windowMs: 60000\n      }\n    })]\n  })\n  async publicEndpoint(req: Request, res: Response) {\n    // 1000 requests per minute\n    res.json({ message: 'Public endpoint' });\n  }\n\n  @post('/auth/login', {\n    middleware: [rateLimiter({\n      keyOptions: {\n        limit: 5,\n        windowMs: 15 * 60 * 1000  // 15 minutes\n      }\n    })]\n  })\n  async login(req: Request, res: Response) {\n    // 5 requests per 15 minutes (prevent brute force)\n    const user = await authenticateUser(req.parsedBody);  // Automatically parsed when using body parser middleware\n    res.json(user);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"custom-key-function",children:"Custom Key Function"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    key: (req) => {\n      // Rate limit by user ID if authenticated, IP otherwise\n      const userId = req.user?.id;\n      return userId || req.ip;\n    },\n    limit: 100,\n    windowMs: 60000\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-response",children:"Error Response"}),"\n",(0,s.jsx)(n.p,{children:"When rate limit is exceeded:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Response: 429 Too Many Requests\n{\n  "error": "Too many requests. Please try again later."\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    limit: 100,\n    windowMs: 60 * 1000  // 100 requests per minute\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"authentication-endpoints",children:"Authentication Endpoints"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    limit: 5,\n    windowMs: 15 * 60 * 1000  // 5 attempts per 15 minutes\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"public-endpoints",children:"Public Endpoints"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    limit: 1000,\n    windowMs: 60 * 1000  // 1000 requests per minute\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sensitive-operations",children:"Sensitive Operations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"rateLimiter: {\n  keyOptions: {\n    limit: 10,\n    windowMs: 60 * 60 * 1000  // 10 requests per hour\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const server = new Server({\n  plugins: {\n    rateLimiter: {\n      keyOptions: {\n        limit: 100,\n        windowMs: 60000\n      }\n    }\n  }\n});\n\n@controller('/api')\nexport class ApiController {\n  // Global rate limit applies here\n  @get('/users')\n  async getUsers(req: Request, res: Response) {\n    res.json(await getUsers());\n  }\n\n  // Custom rate limit for auth endpoint\n  @post('/auth/login', {\n    middleware: [rateLimiter({\n      keyOptions: {\n        limit: 5,\n        windowMs: 15 * 60 * 1000\n      }\n    })]\n  })\n  async login(req: Request, res: Response) {\n    const user = await authenticateUser(req.parsedBody);  // Automatically parsed when using body parser middleware\n    res.json(user);\n  }\n\n  // Custom rate limit by API key\n  @get('/premium', {\n    middleware: [rateLimiter({\n      keyOptions: {\n        key: (req) => req.headers.get('X-API-Key') || req.ip,\n        limit: 1000,\n        windowMs: 60000\n      }\n    })]\n  })\n  async premiumEndpoint(req: Request, res: Response) {\n    res.json({ data: 'premium content' });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"environment-based-configuration",children:"Environment-Based Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const isProduction = process.env.NODE_ENV === 'production';\n\nconst server = new Server({\n  plugins: {\n    rateLimiter: isProduction ? {\n      keyOptions: {\n        limit: 100,\n        windowMs: 60000\n      }\n    } : undefined  // Disable in development\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"custom-storage",children:"Custom Storage"}),"\n",(0,s.jsx)(n.p,{children:"For distributed systems, implement custom storage:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'rateLimiter: {\n  keyOptions: {\n    limit: 100,\n    windowMs: 60000,\n    storageStrategy: "custom",\n    get: async (key) => {\n      // Get from Redis, DynamoDB, etc.\n      return await redis.get(key);\n    },\n    set: async (key, value) => {\n      // Store in Redis, DynamoDB, etc.\n      await redis.set(key, value);\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use different limits for different endpoints"})," - Auth endpoints need stricter limits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider user tier"})," - Premium users might get higher limits"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Monitor rate limit hits"})," - Adjust limits based on actual usage"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use distributed storage"})," - In-memory storage doesn't work across multiple servers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Provide clear error messages"})," - Help users understand why they're being limited"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);