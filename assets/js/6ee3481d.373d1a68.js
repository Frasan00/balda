"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9531],{2553:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>l});const c=JSON.parse('{"id":"cache/cache-keys","title":"Cache Keys","description":"Every cached route gets a unique key computed from the request. Understanding how keys are generated helps you control cache granularity and avoid collisions.","source":"@site/docs/cache/cache-keys.md","sourceDirName":"cache","slug":"/cache/cache-keys","permalink":"/balda/docs/cache/cache-keys","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/cache/cache-keys.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docs","previous":{"title":"Cache Providers","permalink":"/balda/docs/cache/providers"},"next":{"title":"Invalidation","permalink":"/balda/docs/cache/invalidation"}}');var s=r(4848),i=r(8453);const t={sidebar_position:3},d="Cache Keys",a={},l=[{value:"Default Key Structure",id:"default-key-structure",level:2},{value:"The <code>include</code> Option",id:"the-include-option",level:2},{value:"Include query string",id:"include-query-string",level:3},{value:"Include request body",id:"include-request-body",level:3},{value:"Include headers",id:"include-headers",level:3},{value:"Custom discriminator (<code>fromRequest</code>)",id:"custom-discriminator-fromrequest",level:3},{value:"Type-Safe Picks (inline router only)",id:"type-safe-picks-inline-router-only",level:2},{value:"Combining <code>include</code> Options",id:"combining-include-options",level:2}];function o(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cache-keys",children:"Cache Keys"})}),"\n",(0,s.jsx)(n.p,{children:"Every cached route gets a unique key computed from the request. Understanding how keys are generated helps you control cache granularity and avoid collisions."}),"\n",(0,s.jsx)(n.h2,{id:"default-key-structure",children:"Default Key Structure"}),"\n",(0,s.jsx)(n.p,{children:"Cache keys follow this format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"{prefix}:{METHOD}:{pathname}:{params}:{extra}\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"prefix"})})," \u2014 ",(0,s.jsx)(n.code,{children:"keyPrefix"})," from server options (default: ",(0,s.jsx)(n.code,{children:"cache"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"METHOD"})})," \u2014 HTTP method (e.g. ",(0,s.jsx)(n.code,{children:"GET"}),", ",(0,s.jsx)(n.code,{children:"POST"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"pathname"})})," \u2014 request path without query string (e.g. ",(0,s.jsx)(n.code,{children:"/api/users/42"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"params"})})," \u2014 route parameters are always included (e.g. ",(0,s.jsx)(n.code,{children:"id=42"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"extra"})})," \u2014 SHA-256 hash of any additional fields (body, query, headers, custom discriminator)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Route parameters are ",(0,s.jsx)(n.strong,{children:"always"})," part of the key \u2014 no configuration needed."]}),"\n",(0,s.jsxs)(n.h2,{id:"the-include-option",children:["The ",(0,s.jsx)(n.code,{children:"include"})," Option"]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"include"})," on the cache config to control which additional request data is hashed into the key."]}),"\n",(0,s.jsx)(n.h3,{id:"include-query-string",children:"Include query string"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Decorator\n@cache({ ttl: 60, include: { query: true } })\n\n// Inline router\nserver.router.get('/products', { cache: { ttl: 60, include: { query: true } } }, handler);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Specific fields only:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@cache({ ttl: 60, include: { query: ['page', 'limit'] } })\n"})}),"\n",(0,s.jsx)(n.h3,{id:"include-request-body",children:"Include request body"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@post('/search')\n@cache({ ttl: 30, include: { body: true } })\nasync search(req, res) { /* ... */ }\n"})}),"\n",(0,s.jsx)(n.p,{children:"Specific body fields:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@cache({ ttl: 30, include: { body: ['q', 'filters'] } })\n"})}),"\n",(0,s.jsx)(n.h3,{id:"include-headers",children:"Include headers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@cache({ ttl: 120, include: { headers: ['x-tenant-id'] } })\n"})}),"\n",(0,s.jsx)(n.p,{children:"Useful for tenant-aware caching where different tenants must not share cached data."}),"\n",(0,s.jsxs)(n.h3,{id:"custom-discriminator-fromrequest",children:["Custom discriminator (",(0,s.jsx)(n.code,{children:"fromRequest"}),")"]}),"\n",(0,s.jsxs)(n.p,{children:["For any request-derived value not covered by body/query/headers, use ",(0,s.jsx)(n.code,{children:"fromRequest"}),". Its return value is hashed and appended to the key."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@cache({\n  ttl: 60,\n  include: {\n    fromRequest: (req) => req.headers.get('x-user-role'),\n  },\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"type-safe-picks-inline-router-only",children:"Type-Safe Picks (inline router only)"}),"\n",(0,s.jsxs)(n.p,{children:["When you register routes with schemas via the inline router, the ",(0,s.jsx)(n.code,{children:"include"})," picks are fully type-safe \u2014 TypeScript will only allow valid field names from your schema."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { z } from 'zod';\n\nconst querySchema = z.object({\n  page: z.number(),\n  limit: z.number(),\n  status: z.string(),\n});\n\nserver.router.get(\n  '/orders',\n  {\n    query: querySchema,\n    cache: {\n      ttl: 60,\n      include: {\n        query: ['page', 'limit'], // \u2705 TypeScript checks these against querySchema\n      },\n    },\n  },\n  (req, res) => {\n    res.json(req.query); // req.query is fully typed\n  },\n);\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"@cache()"})," decorator does not have access to schema types at compile time, so ",(0,s.jsx)(n.code,{children:"include"})," field picks are not type-checked in decorators. Use the inline router config for type-safe picks."]})}),"\n",(0,s.jsxs)(n.h2,{id:"combining-include-options",children:["Combining ",(0,s.jsx)(n.code,{children:"include"})," Options"]}),"\n",(0,s.jsxs)(n.p,{children:["All ",(0,s.jsx)(n.code,{children:"include"})," options can be combined:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"@cache({\n  ttl: 60,\n  include: {\n    query: ['page'],\n    headers: ['x-tenant-id'],\n    fromRequest: (req) => req.headers.get('accept-language'),\n  },\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"Each non-empty part is JSON-serialized in a stable order, concatenated, and SHA-256 hashed to form the key suffix."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var c=r(6540);const s={},i=c.createContext(s);function t(e){const n=c.useContext(i);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);