"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3446],{4516:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>p,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"plugins/body-parser","title":"Body Parser","description":"Balda includes a unified body parser middleware that automatically handles multiple content types. When enabled, it populates req.body with the parsed request data based on the Content-Type header.","source":"@site/docs/plugins/body-parser.md","sourceDirName":"plugins","slug":"/plugins/body-parser","permalink":"/balda/docs/plugins/body-parser","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/plugins/body-parser.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docs","previous":{"title":"Plugins Overview","permalink":"/balda/docs/plugins/overview"},"next":{"title":"CORS Plugin","permalink":"/balda/docs/plugins/cors"}}');var l=s(4848),r=s(8453);const d={sidebar_position:3},t="Body Parser",a={},o=[{value:"Supported Content Types",id:"supported-content-types",level:2},{value:"Body Parser Behavior",id:"body-parser-behavior",level:2},{value:"Without Body Parser Plugin",id:"without-body-parser-plugin",level:3},{value:"With Body Parser Plugin",id:"with-body-parser-plugin",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"JSON Parsing",id:"json-parsing",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Usage Example",id:"usage-example",level:3},{value:"JSON Configuration Options",id:"json-configuration-options",level:3},{value:"JSON Error Responses",id:"json-error-responses",level:3},{value:"Size Limit Exceeded",id:"size-limit-exceeded",level:4},{value:"Invalid JSON",id:"invalid-json",level:4},{value:"JSON Content-Type Detection",id:"json-content-type-detection",level:3},{value:"Supported HTTP Methods",id:"supported-http-methods",level:3},{value:"URL-Encoded Form Parsing",id:"url-encoded-form-parsing",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Usage Example",id:"usage-example-1",level:3},{value:"HTML Form Example",id:"html-form-example",level:3},{value:"Extended Parsing",id:"extended-parsing",level:3},{value:"URL-Encoded Configuration Options",id:"url-encoded-configuration-options",level:3},{value:"URL-Encoded Error Responses",id:"url-encoded-error-responses",level:3},{value:"Body Too Large",id:"body-too-large",level:4},{value:"Too Many Parameters",id:"too-many-parameters",level:4},{value:"File Upload Parsing",id:"file-upload-parsing",level:2},{value:"Configuration",id:"configuration-2",level:3},{value:"Usage Example",id:"usage-example-2",level:3},{value:"Single File Upload",id:"single-file-upload",level:4},{value:"Multiple Files Upload",id:"multiple-files-upload",level:4},{value:"HTML File Upload Form",id:"html-file-upload-form",level:3},{value:"File Object",id:"file-object",level:3},{value:"File Configuration Options",id:"file-configuration-options",level:3},{value:"Security Features",id:"security-features",level:3},{value:"Filename Sanitization",id:"filename-sanitization",level:4},{value:"Cryptographically Secure Temporary Files",id:"cryptographically-secure-temporary-files",level:4},{value:"Automatic Cleanup",id:"automatic-cleanup",level:4},{value:"File Error Responses",id:"file-error-responses",level:3},{value:"File Too Large",id:"file-too-large",level:4},{value:"Too Many Files",id:"too-many-files",level:4},{value:"Invalid MIME Type",id:"invalid-mime-type",level:4},{value:"Missing Content-Type",id:"missing-content-type",level:4},{value:"Complete Configuration Example",id:"complete-configuration-example",level:2},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"API Endpoint (JSON)",id:"api-endpoint-json",level:3},{value:"Contact Form (URL-encoded)",id:"contact-form-url-encoded",level:3},{value:"User Registration with Profile Picture",id:"user-registration-with-profile-picture",level:3},{value:"Document Upload API",id:"document-upload-api",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Set Appropriate Size Limits",id:"1-set-appropriate-size-limits",level:3},{value:"2. Use Environment-Based Configuration",id:"2-use-environment-based-configuration",level:3},{value:"3. Validate MIME Types for File Uploads",id:"3-validate-mime-types-for-file-uploads",level:3},{value:"4. Handle Empty Bodies Explicitly",id:"4-handle-empty-bodies-explicitly",level:3},{value:"5. Store Uploaded Files Securely",id:"5-store-uploaded-files-securely",level:3},{value:"Performance Tips",id:"performance-tips",level:2},{value:"Disabling Body Parsers",id:"disabling-body-parsers",level:2}];function c(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"body-parser",children:"Body Parser"})}),"\n",(0,l.jsxs)(n.p,{children:["Balda includes a unified body parser middleware that automatically handles multiple content types. When enabled, it populates ",(0,l.jsx)(n.code,{children:"req.body"})," with the parsed request data based on the ",(0,l.jsx)(n.code,{children:"Content-Type"})," header."]}),"\n",(0,l.jsxs)(n.admonition,{title:"Web API Compatibility Layer",type:"info",children:[(0,l.jsx)(n.p,{children:"Balda's Request and Response classes provide compatibility layers for seamless interoperability with Web API objects:"}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"Request.fromRequest(webRequest)"})}),": Converts Web API Request to Balda Request"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"req.toWebApi()"})}),": Converts Balda Request back to Web API Request"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"Response.toWebResponse(baldaRes)"})}),": Converts Balda Response to Web API Response"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"req.body"})}),": The parsed body set by body parser middleware (default: ",(0,l.jsx)(n.code,{children:"undefined"}),"). ",(0,l.jsx)(n.strong,{children:"Use this in your route handlers"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:(0,l.jsx)(n.code,{children:"req.bodyUsed"})}),": Boolean flag indicating if the body has been read (prevents double-reading errors)"]}),"\n"]})]}),"\n",(0,l.jsx)(n.h2,{id:"supported-content-types",children:"Supported Content Types"}),"\n",(0,l.jsx)(n.p,{children:"The body parser middleware automatically detects and parses three content types:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Content Type"}),(0,l.jsx)(n.th,{children:"Plugin Setting"}),(0,l.jsx)(n.th,{children:"Parses To"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"application/json"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"json"})}),(0,l.jsx)(n.td,{children:"JavaScript object"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"application/x-www-form-urlencoded"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"urlencoded"})}),(0,l.jsx)(n.td,{children:"JavaScript object"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"multipart/form-data"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"file"})}),(0,l.jsxs)(n.td,{children:["Files available via ",(0,l.jsx)(n.code,{children:"req.file"})," and ",(0,l.jsx)(n.code,{children:"req.files"})]})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"body-parser-behavior",children:"Body Parser Behavior"}),"\n",(0,l.jsx)(n.h3,{id:"without-body-parser-plugin",children:"Without Body Parser Plugin"}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.strong,{children:"no body parser plugins are enabled"}),", ",(0,l.jsx)(n.code,{children:"req.body"})," remains ",(0,l.jsx)(n.code,{children:"undefined"})," for all requests. This is the default behavior:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"const server = new Server({\n  // No body parser plugins configured\n});\n\n// In your route handler:\n@post('/users')\nasync createUser(req: Request, res: Response) {\n  console.log(req.body); // undefined\n\n  // To read the raw body, use:\n  const rawBody = await req.toWebApi().arrayBuffer();\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"with-body-parser-plugin",children:"With Body Parser Plugin"}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.strong,{children:"body parser plugins are enabled"}),", ",(0,l.jsx)(n.code,{children:"req.body"})," is automatically populated based on the request's ",(0,l.jsx)(n.code,{children:"Content-Type"})," header."]}),"\n",(0,l.jsxs)(n.admonition,{title:"Method Restrictions",type:"note",children:[(0,l.jsxs)(n.p,{children:["Body parsing is ",(0,l.jsx)(n.strong,{children:"only applied"})," to methods that can have a request body:"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.code,{children:"POST"}),", ",(0,l.jsx)(n.code,{children:"PUT"}),", ",(0,l.jsx)(n.code,{children:"PATCH"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u274c ",(0,l.jsx)(n.code,{children:"GET"}),", ",(0,l.jsx)(n.code,{children:"DELETE"}),", ",(0,l.jsx)(n.code,{children:"OPTIONS"})," (body remains ",(0,l.jsx)(n.code,{children:"undefined"}),")"]}),"\n"]}),(0,l.jsx)(n.p,{children:"This is by design to follow HTTP semantics and optimize performance."})]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Content Type"}),(0,l.jsx)(n.th,{children:"Behavior"}),(0,l.jsxs)(n.th,{children:[(0,l.jsx)(n.code,{children:"req.body"})," Value"]})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"application/json"})}),(0,l.jsx)(n.td,{children:"Parsed as JSON"}),(0,l.jsx)(n.td,{children:"JavaScript object"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"application/x-www-form-urlencoded"})}),(0,l.jsx)(n.td,{children:"Parsed as form data"}),(0,l.jsx)(n.td,{children:"JavaScript object"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"multipart/form-data"})}),(0,l.jsx)(n.td,{children:"Files extracted"}),(0,l.jsxs)(n.td,{children:["Files in ",(0,l.jsx)(n.code,{children:"req.files"}),", form fields in ",(0,l.jsx)(n.code,{children:"req.body"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"text/*"})," (e.g., ",(0,l.jsx)(n.code,{children:"text/plain"}),")"]}),(0,l.jsx)(n.td,{children:"Decoded as string"}),(0,l.jsx)(n.td,{children:"String"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"All other types"})}),(0,l.jsx)(n.td,{children:"Raw binary data"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"ArrayBuffer"})})]})]})]}),"\n",(0,l.jsxs)(n.admonition,{title:"Fallback Behavior",type:"tip",children:[(0,l.jsxs)(n.p,{children:["For ",(0,l.jsx)(n.strong,{children:"unhandled content types"})," (like ",(0,l.jsx)(n.code,{children:"application/octet-stream"}),", ",(0,l.jsx)(n.code,{children:"application/pdf"}),", custom MIME types, etc.), the body parser automatically provides the raw body as an ",(0,l.jsx)(n.code,{children:"ArrayBuffer"}),". This allows you to implement custom parsers for specialized content types."]}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@post('/upload')\nasync handleCustomFormat(req: Request, res: Response) {\n  // For content type \"application/custom\"\n  const buffer = req.body as ArrayBuffer; // Raw binary data\n\n  // Implement your custom parsing logic\n  const customData = parseCustomFormat(buffer);\n\n  res.json({ success: true });\n}\n"})})]}),"\n",(0,l.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst server = new Server({\n  plugins: {\n    json: { sizeLimit: \"10mb\" },\n    urlencoded: { limit: 2 * 1024 * 1024 },\n    file: { maxFileSize: '5mb' }\n  }\n});\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"json-parsing",children:"JSON Parsing"}),"\n",(0,l.jsxs)(n.p,{children:["Parses ",(0,l.jsx)(n.code,{children:"application/json"})," request bodies and populates ",(0,l.jsx)(n.code,{children:"req.body"})," with the parsed JavaScript object."]}),"\n",(0,l.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  json: {\n    sizeLimit: \"100kb\",              // Maximum body size (default: \"100kb\")\n    parseEmptyBodyAsObject: false,   // Parse empty body as {} (default: false)\n    encoding: 'utf-8',               // Text encoding (default: 'utf-8')\n    customErrorMessage: {            // Custom error response (optional)\n      status: 413,\n      message: 'Payload too large'\n    }\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"usage-example",children:"Usage Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@controller('/api')\nexport class ApiController {\n  @post('/users')\n  async createUser(req: Request, res: Response) {\n    const { name, email } = req.body;  // Automatically parsed when using body parser middleware with json setting\n    res.created({ name, email });\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"json-configuration-options",children:"JSON Configuration Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Option"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"sizeLimit"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:'"100kb"'})}),(0,l.jsxs)(n.td,{children:["Maximum request body size (",(0,l.jsx)(n.code,{children:"kb"})," or ",(0,l.jsx)(n.code,{children:"mb"}),")"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"parseEmptyBodyAsObject"})}),(0,l.jsx)(n.td,{children:"boolean"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"false"})}),(0,l.jsxs)(n.td,{children:["Parse empty body as ",(0,l.jsx)(n.code,{children:"{}"})," instead of ",(0,l.jsx)(n.code,{children:"undefined"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"encoding"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'utf-8'"})}),(0,l.jsx)(n.td,{children:"Text encoding for decoding"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"customErrorMessage"})}),(0,l.jsx)(n.td,{children:"object"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"Custom error response for size limit"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"json-error-responses",children:"JSON Error Responses"}),"\n",(0,l.jsx)(n.h4,{id:"size-limit-exceeded",children:"Size Limit Exceeded"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 413 Payload Too Large\n{\n  "error": "ERR_REQUEST_BODY_TOO_LARGE"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"invalid-json",children:"Invalid JSON"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Invalid JSON syntax"\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"json-content-type-detection",children:"JSON Content-Type Detection"}),"\n",(0,l.jsx)(n.p,{children:"Automatically parses requests with:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"application/json"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"application/json; charset=utf-8"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"supported-http-methods",children:"Supported HTTP Methods"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Parsed"}),": POST, PUT, PATCH"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Ignored"}),": GET, DELETE, HEAD, OPTIONS"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"url-encoded-form-parsing",children:"URL-Encoded Form Parsing"}),"\n",(0,l.jsxs)(n.p,{children:["Parses ",(0,l.jsx)(n.code,{children:"application/x-www-form-urlencoded"})," request bodies (HTML form submissions) and populates ",(0,l.jsx)(n.code,{children:"req.body"})," with the parsed data."]}),"\n",(0,l.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  urlencoded: {\n    limit: 1048576,           // Maximum body size in bytes (default: 1MB)\n    extended: false,          // Parse rich objects and arrays (default: false)\n    charset: 'utf8',          // Character encoding (default: 'utf8')\n    allowEmpty: true,         // Allow empty values (default: true)\n    parameterLimit: 1000      // Maximum number of parameters (default: 1000)\n  }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Or enable with defaults:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  urlencoded: true  // Use default settings\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"usage-example-1",children:"Usage Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@controller('/api')\nexport class FormController {\n  @post('/submit')\n  async handleSubmit(req: Request, res: Response) {\n    const { name, email, message } = req.body;  // Automatically parsed when using body parser middleware with urlencoded setting\n\n    res.json({\n      received: { name, email, message }\n    });\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"html-form-example",children:"HTML Form Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-html",children:'<form action="/api/submit" method="POST">\n  <input type="text" name="name" value="John" />\n  <input type="email" name="email" value="john@example.com" />\n  <textarea name="message">Hello!</textarea>\n  <button type="submit">Submit</button>\n</form>\n\n\x3c!-- Body sent: name=John&email=john@example.com&message=Hello! --\x3e\n'})}),"\n",(0,l.jsx)(n.h3,{id:"extended-parsing",children:"Extended Parsing"}),"\n",(0,l.jsxs)(n.p,{children:["With ",(0,l.jsx)(n.code,{children:"extended: true"}),", parse nested objects and arrays:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-html",children:'<form action="/api/user" method="POST">\n  <input name="user[name]" value="John" />\n  <input name="user[email]" value="john@example.com" />\n  <input name="tags[]" value="developer" />\n  <input name="tags[]" value="designer" />\n</form>\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@post('/user')\nasync createUser(req: Request, res: Response) {\n  console.log(req.body);  // Automatically parsed when using body parser middleware with urlencoded setting\n  // {\n  //   user: { name: 'John', email: 'john@example.com' },\n  //   tags: ['developer', 'designer']\n  // }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"url-encoded-configuration-options",children:"URL-Encoded Configuration Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Option"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"limit"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"1048576"})," (1MB)"]}),(0,l.jsx)(n.td,{children:"Maximum body size in bytes"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"extended"})}),(0,l.jsx)(n.td,{children:"boolean"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"false"})}),(0,l.jsx)(n.td,{children:"Parse rich objects and arrays"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"charset"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'utf8'"})}),(0,l.jsx)(n.td,{children:"Character encoding"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"allowEmpty"})}),(0,l.jsx)(n.td,{children:"boolean"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"true"})}),(0,l.jsx)(n.td,{children:"Allow empty values"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"parameterLimit"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"1000"})}),(0,l.jsx)(n.td,{children:"Maximum parameters to parse"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"url-encoded-error-responses",children:"URL-Encoded Error Responses"}),"\n",(0,l.jsx)(n.h4,{id:"body-too-large",children:"Body Too Large"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 413 Payload Too Large\n{\n  "error": "Request body exceeds limit"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"too-many-parameters",children:"Too Many Parameters"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Too many parameters"\n}\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"file-upload-parsing",children:"File Upload Parsing"}),"\n",(0,l.jsxs)(n.p,{children:["Handles ",(0,l.jsx)(n.code,{children:"multipart/form-data"})," file uploads with comprehensive security features. Automatically parses uploaded files and provides access through ",(0,l.jsx)(n.code,{children:"req.file"})," and ",(0,l.jsx)(n.code,{children:"req.files"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"configuration-2",children:"Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  file: {\n    maxFileSize: '5mb',       // Maximum size per file (default: '1mb')\n    maxFiles: 10,             // Maximum number of files (default: 10)\n    allowedMimeTypes: [       // Whitelist of allowed MIME types (default: [] - all allowed)\n      'image/jpeg',\n      'image/png',\n      'application/pdf'\n    ]\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"usage-example-2",children:"Usage Example"}),"\n",(0,l.jsx)(n.h4,{id:"single-file-upload",children:"Single File Upload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@controller('/api')\nexport class UploadController {\n  @post('/upload')\n  async uploadFile(req: Request, res: Response) {\n    const file = req.file;  // Single file\n\n    if (!file) {\n      return res.badRequest({ error: 'No file uploaded' });\n    }\n\n    res.json({\n      filename: file.filename,\n      originalFilename: file.originalFilename,\n      size: file.size,\n      mimeType: file.mimeType,\n      path: file.path\n    });\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"multiple-files-upload",children:"Multiple Files Upload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@post('/upload/multiple')\nasync uploadMultiple(req: Request, res: Response) {\n  const files = req.files;  // Array of files\n\n  if (!files || files.length === 0) {\n    return res.badRequest({ error: 'No files uploaded' });\n  }\n\n  const fileInfos = files.map(f => ({\n    filename: f.filename,\n    size: f.size,\n    mimeType: f.mimeType\n  }));\n\n  res.json({ files: fileInfos });\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"html-file-upload-form",children:"HTML File Upload Form"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-html",children:'\x3c!-- Single file --\x3e\n<form action="/api/upload" method="POST" enctype="multipart/form-data">\n  <input type="file" name="file" />\n  <button type="submit">Upload</button>\n</form>\n\n\x3c!-- Multiple files --\x3e\n<form action="/api/upload/multiple" method="POST" enctype="multipart/form-data">\n  <input type="file" name="files" multiple />\n  <button type="submit">Upload Files</button>\n</form>\n'})}),"\n",(0,l.jsx)(n.h3,{id:"file-object",children:"File Object"}),"\n",(0,l.jsx)(n.p,{children:"Each uploaded file contains:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'{\n  filename: string;           // Sanitized filename (e.g., "avatar.png")\n  originalFilename: string;   // Original uploaded filename\n  path: string;              // Temporary file path\n  size: number;              // File size in bytes\n  mimeType: string;          // MIME type (e.g., "image/png")\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"file-configuration-options",children:"File Configuration Options"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Option"}),(0,l.jsx)(n.th,{children:"Type"}),(0,l.jsx)(n.th,{children:"Default"}),(0,l.jsx)(n.th,{children:"Description"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxFileSize"})}),(0,l.jsx)(n.td,{children:"string"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"'1mb'"})}),(0,l.jsxs)(n.td,{children:["Maximum size per file (",(0,l.jsx)(n.code,{children:"kb"})," or ",(0,l.jsx)(n.code,{children:"mb"}),")"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"maxFiles"})}),(0,l.jsx)(n.td,{children:"number"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"10"})}),(0,l.jsx)(n.td,{children:"Maximum number of files per request"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"allowedMimeTypes"})}),(0,l.jsx)(n.td,{children:"string[]"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"[]"})}),(0,l.jsx)(n.td,{children:"Whitelist of allowed MIME types (empty = all)"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"security-features",children:"Security Features"}),"\n",(0,l.jsx)(n.h4,{id:"filename-sanitization",children:"Filename Sanitization"}),"\n",(0,l.jsx)(n.p,{children:"Automatically removes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Path traversal (",(0,l.jsx)(n.code,{children:"../"}),")"]}),"\n",(0,l.jsxs)(n.li,{children:["Directory separators (",(0,l.jsx)(n.code,{children:"/"}),", ",(0,l.jsx)(n.code,{children:"\\"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Null bytes"}),"\n",(0,l.jsx)(n.li,{children:"Control characters"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'// Input: "../../../etc/passwd"\n// Sanitized: "etcpasswd"\n\n// Input: "file\\x00.txt"\n// Sanitized: "file.txt"\n'})}),"\n",(0,l.jsx)(n.h4,{id:"cryptographically-secure-temporary-files",children:"Cryptographically Secure Temporary Files"}),"\n",(0,l.jsx)(n.p,{children:"Temporary files use UUID-based filenames to prevent:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Filename collisions"}),"\n",(0,l.jsx)(n.li,{children:"Predictable paths"}),"\n",(0,l.jsx)(n.li,{children:"Overwriting attacks"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"automatic-cleanup",children:"Automatic Cleanup"}),"\n",(0,l.jsx)(n.p,{children:"Temporary files are automatically deleted after request completion, even if errors occur."}),"\n",(0,l.jsx)(n.h3,{id:"file-error-responses",children:"File Error Responses"}),"\n",(0,l.jsx)(n.h4,{id:"file-too-large",children:"File Too Large"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 413 Payload Too Large\n{\n  "error": "File size exceeds limit"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"too-many-files",children:"Too Many Files"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Too many files. Maximum 10 allowed"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"invalid-mime-type",children:"Invalid MIME Type"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Invalid file type. Allowed: image/jpeg, image/png"\n}\n'})}),"\n",(0,l.jsx)(n.h4,{id:"missing-content-type",children:"Missing Content-Type"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Content-Type must be multipart/form-data"\n}\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"complete-configuration-example",children:"Complete Configuration Example"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst isProduction = process.env.NODE_ENV === 'production';\n\nconst server = new Server({\n  port: 3000,\n  plugins: {\n    // JSON parsing\n    json: {\n      sizeLimit: isProduction ? \"1mb\" : \"10mb\",\n      parseEmptyBodyAsObject: false,\n      encoding: 'utf-8'\n    },\n\n    // URL-encoded form parsing\n    urlencoded: {\n      limit: 2 * 1024 * 1024,  // 2MB\n      extended: true,           // Support nested objects\n      charset: 'utf8'\n    },\n\n    // File upload parsing\n    file: {\n      maxFileSize: '10mb',\n      maxFiles: 5,\n      allowedMimeTypes: [\n        'image/jpeg',\n        'image/png',\n        'image/gif',\n        'application/pdf'\n      ]\n    }\n  }\n});\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,l.jsx)(n.h3,{id:"api-endpoint-json",children:"API Endpoint (JSON)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'plugins: {\n  json: { sizeLimit: "10mb" }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"contact-form-url-encoded",children:"Contact Form (URL-encoded)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  urlencoded: {\n    limit: 1 * 1024 * 1024,  // 1MB\n    extended: false\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"user-registration-with-profile-picture",children:"User Registration with Profile Picture"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  json: { sizeLimit: \"1mb\" },\n  file: {\n    maxFileSize: '2mb',\n    maxFiles: 1,\n    allowedMimeTypes: ['image/jpeg', 'image/png']\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"document-upload-api",children:"Document Upload API"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  json: { sizeLimit: \"1mb\" },\n  file: {\n    maxFileSize: '10mb',\n    maxFiles: 3,\n    allowedMimeTypes: [\n      'application/pdf',\n      'application/msword',\n      'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n    ]\n  }\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsx)(n.h3,{id:"1-set-appropriate-size-limits",children:"1. Set Appropriate Size Limits"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'plugins: {\n  json: { sizeLimit: "10mb" },        // For API payloads\n  urlencoded: { limit: 1048576 },     // For HTML forms (1MB)\n  file: { maxFileSize: "50mb" }       // For file uploads\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-use-environment-based-configuration",children:"2. Use Environment-Based Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'const isProduction = process.env.NODE_ENV === \'production\';\n\nplugins: {\n  json: {\n    sizeLimit: isProduction ? "1mb" : "10mb"\n  }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"3-validate-mime-types-for-file-uploads",children:"3. Validate MIME Types for File Uploads"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  file: {\n    allowedMimeTypes: [\n      'image/jpeg',\n      'image/png',\n      'image/gif'\n    ]\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"4-handle-empty-bodies-explicitly",children:"4. Handle Empty Bodies Explicitly"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@post('/health')\nasync healthCheck(req: Request, res: Response) {\n  if (req.body === undefined) {\n    // Handle empty body case\n    res.json({ status: 'ok', body: 'empty' });\n  }\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"5-store-uploaded-files-securely",children:"5. Store Uploaded Files Securely"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"@post('/upload')\nasync handleUpload(req: Request, res: Response) {\n  const file = req.file;\n\n  // Move to permanent storage (e.g., S3, cloud storage)\n  await moveFile(file.path, `uploads/${file.filename}`);\n\n  res.json({ success: true, filename: file.filename });\n}\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Set reasonable size limits to prevent memory issues"}),"\n",(0,l.jsx)(n.li,{children:"Use file uploads for large payloads instead of JSON"}),"\n",(0,l.jsxs)(n.li,{children:["Enable ",(0,l.jsx)(n.code,{children:"extended: false"})," for URL-encoded parsing if you don't need nested objects"]}),"\n",(0,l.jsxs)(n.li,{children:["Use ",(0,l.jsx)(n.code,{children:"allowedMimeTypes"})," to prevent unwanted file uploads"]}),"\n",(0,l.jsx)(n.li,{children:"Store files in object storage (S3, etc.) for production"}),"\n",(0,l.jsx)(n.li,{children:"Validate file contents, not just MIME types"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"disabling-body-parsers",children:"Disabling Body Parsers"}),"\n",(0,l.jsxs)(n.p,{children:["You can disable any of the body parsers by setting them to ",(0,l.jsx)(n.code,{children:"false"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"plugins: {\n  json: false,        // Disable JSON parsing\n  urlencoded: false,  // Disable URL-encoded parsing\n  file: false         // Disable file uploads\n}\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>t});var i=s(6540);const l={},r=i.createContext(l);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);