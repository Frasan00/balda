"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1613],{5158:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>t,default:()=>l,frontMatter:()=>d,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"cache/overview","title":"Caching Overview","description":"Balda ships with a first-class, provider-agnostic HTTP caching layer. When enabled, it transparently intercepts route handlers, stores responses in your chosen backend, and serves subsequent identical requests directly from cache \u2014 without executing the handler again.","source":"@site/docs/cache/overview.md","sourceDirName":"cache","slug":"/cache/overview","permalink":"/balda/docs/cache/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/cache/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Cache Monitoring","permalink":"/balda/docs/performance/cache-monitoring"},"next":{"title":"Cache Providers","permalink":"/balda/docs/cache/providers"}}');var c=n(4848),i=n(8453);const d={sidebar_position:1},t="Caching Overview",o={},h=[{value:"Features",id:"features",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Server Configuration",id:"server-configuration",level:2},{value:"The <code>x-cache</code> Response Header",id:"the-x-cache-response-header",level:2},{value:"Accessing the Cache Service",id:"accessing-the-cache-service",level:2}];function a(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(s.header,{children:(0,c.jsx)(s.h1,{id:"caching-overview",children:"Caching Overview"})}),"\n",(0,c.jsx)(s.p,{children:"Balda ships with a first-class, provider-agnostic HTTP caching layer. When enabled, it transparently intercepts route handlers, stores responses in your chosen backend, and serves subsequent identical requests directly from cache \u2014 without executing the handler again."}),"\n",(0,c.jsx)(s.h2,{id:"features",children:"Features"}),"\n",(0,c.jsxs)(s.ul,{children:["\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Zero-config in-memory cache"})," \u2014 works out of the box, no dependencies"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Redis backend"})," \u2014 persistent, shared cache across multiple instances (",(0,c.jsx)(s.code,{children:"ioredis"}),")"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Custom providers"})," \u2014 bring any storage backend via the ",(0,c.jsx)(s.code,{children:"CacheProvider"})," interface"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Fine-grained key control"})," \u2014 include body, query, headers, or a custom discriminator in the cache key"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Tag-based invalidation"})," \u2014 group entries by tag and invalidate them in one call"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Thundering herd protection"})," \u2014 distributed locks prevent cache stampedes"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Response compression"})," \u2014 gzip large responses before storing"]}),"\n",(0,c.jsxs)(s.li,{children:[(0,c.jsx)(s.strong,{children:"Statistics"})," \u2014 track hit rate, miss count, and invalidations via ",(0,c.jsx)(s.code,{children:"server.cache.getStats()"})]}),"\n"]}),"\n",(0,c.jsx)(s.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-ts",children:"import { Server } from 'balda';\n\nconst server = new Server({\n  port: 3000,\n  cache: {\n    provider: 'memory',   // or 'redis', or a custom CacheProvider instance\n    defaultTtl: 300,      // seconds\n  },\n});\n\nawait server.listen();\n"})}),"\n",(0,c.jsxs)(s.p,{children:["Once configured, use the ",(0,c.jsx)(s.code,{children:"@cache()"})," decorator or the inline router config on any route:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-ts",children:"import { controller, get, cache } from 'balda';\n\n@controller('/api/products')\nclass ProductController {\n  @get('/')\n  @cache({ ttl: 60 })\n  async list(_req, res) {\n    res.json(await db.products.findAll());\n  }\n}\n"})}),"\n",(0,c.jsx)(s.h2,{id:"server-configuration",children:"Server Configuration"}),"\n",(0,c.jsxs)(s.p,{children:["Pass a ",(0,c.jsx)(s.code,{children:"cache"})," object inside ",(0,c.jsx)(s.code,{children:"ServerOptions"})," to enable the cache system."]}),"\n",(0,c.jsxs)(s.table,{children:[(0,c.jsx)(s.thead,{children:(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.th,{children:"Option"}),(0,c.jsx)(s.th,{children:"Type"}),(0,c.jsx)(s.th,{children:"Default"}),(0,c.jsx)(s.th,{children:"Description"})]})}),(0,c.jsxs)(s.tbody,{children:[(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"provider"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"'memory' | 'redis' | CacheProvider"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"'memory'"})}),(0,c.jsx)(s.td,{children:"Cache backend to use"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"redis"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"CacheRedisOptions"})}),(0,c.jsx)(s.td,{children:"\u2014"}),(0,c.jsxs)(s.td,{children:["Redis connection options (when ",(0,c.jsx)(s.code,{children:"provider: 'redis'"}),")"]})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"defaultTtl"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"number"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"300"})}),(0,c.jsx)(s.td,{children:"Default TTL in seconds (max 86400)"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"compressionThreshold"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"number"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"1024"})}),(0,c.jsx)(s.td,{children:"Min response size (bytes) before gzip compression"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"keyPrefix"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"string"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"'cache'"})}),(0,c.jsx)(s.td,{children:"Prefix applied to all cache keys"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"enableStats"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"boolean"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"true"})}),(0,c.jsx)(s.td,{children:"Track hit/miss statistics"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"lockTimeout"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"number"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"5000"})}),(0,c.jsx)(s.td,{children:"Lock TTL in ms for thundering herd protection"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"lockBehavior"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"'wait' | 'bypass' | 'fail'"})}),(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"'wait'"})}),(0,c.jsx)(s.td,{children:"What to do when a lock can't be acquired"})]})]})]}),"\n",(0,c.jsxs)(s.h2,{id:"the-x-cache-response-header",children:["The ",(0,c.jsx)(s.code,{children:"x-cache"})," Response Header"]}),"\n",(0,c.jsxs)(s.p,{children:["Every response from a cached route includes an ",(0,c.jsx)(s.code,{children:"x-cache"})," header indicating the cache status:"]}),"\n",(0,c.jsxs)(s.table,{children:[(0,c.jsx)(s.thead,{children:(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.th,{children:"Value"}),(0,c.jsx)(s.th,{children:"Meaning"})]})}),(0,c.jsxs)(s.tbody,{children:[(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"MISS"})}),(0,c.jsx)(s.td,{children:"Cache miss \u2014 handler executed, response stored"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"HIT"})}),(0,c.jsx)(s.td,{children:"Cache hit \u2014 response served from cache"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"WAIT"})}),(0,c.jsx)(s.td,{children:"Request waited for another in-flight request to populate the cache"})]}),(0,c.jsxs)(s.tr,{children:[(0,c.jsx)(s.td,{children:(0,c.jsx)(s.code,{children:"BYPASS"})}),(0,c.jsxs)(s.td,{children:["Lock could not be acquired and ",(0,c.jsx)(s.code,{children:"lockBehavior"})," was ",(0,c.jsx)(s.code,{children:"'bypass'"})]})]})]})]}),"\n",(0,c.jsx)(s.h2,{id:"accessing-the-cache-service",children:"Accessing the Cache Service"}),"\n",(0,c.jsxs)(s.p,{children:["After configuring ",(0,c.jsx)(s.code,{children:"cache"})," in server options, ",(0,c.jsx)(s.code,{children:"server.cache"})," exposes the full ",(0,c.jsx)(s.code,{children:"CacheService"})," API:"]}),"\n",(0,c.jsx)(s.pre,{children:(0,c.jsx)(s.code,{className:"language-ts",children:"// Invalidate by tags\nawait server.cache.invalidate(['products']);\n\n// Invalidate a specific key\nawait server.cache.invalidateKey('cache:GET:/api/products::abc123');\n\n// Get statistics\nconst stats = server.cache.getStats();\nconsole.log(`Hit rate: ${(stats.hitRate * 100).toFixed(1)}%`);\n"})}),"\n",(0,c.jsx)(s.admonition,{type:"warning",children:(0,c.jsxs)(s.p,{children:[(0,c.jsx)(s.code,{children:"server.cache"})," throws if accessed before ",(0,c.jsx)(s.code,{children:"cache"})," is configured in ",(0,c.jsx)(s.code,{children:"ServerOptions"}),". Always configure it first."]})})]})}function l(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,c.jsx)(s,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>t});var r=n(6540);const c={},i=r.createContext(c);function d(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:d(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);