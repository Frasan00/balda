"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1935],{6261:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"queues/overview","title":"overview","description":"Queues Overview","source":"@site/docs/queues/overview.md","sourceDirName":"queues","slug":"/queues/overview","permalink":"/balda/docs/queues/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/queues/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Overview","permalink":"/balda/docs/cron/overview"},"next":{"title":"publishing","permalink":"/balda/docs/queues/publishing"}}');var i=s(4848),t=s(8453);const o={sidebar_position:1},l=void 0,a={},c=[{value:"Queues Overview",id:"queues-overview",level:3},{value:"Core building blocks",id:"core-building-blocks",level:4},{value:"Quick start",id:"quick-start",level:4},{value:"Alternative: Manual import",id:"alternative-manual-import",level:4},{value:"Registration approaches",id:"registration-approaches",level:4}];function u(e){const n={code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"queues-overview",children:"Queues Overview"}),"\n",(0,i.jsx)(n.p,{children:"Balda provides a lightweight, provider-agnostic queue abstraction to publish and consume background jobs with a clean, type\u2011safe API. It ships with first\u2011class providers for BullMQ and AWS SQS, and allows custom providers."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Decorator-based consumers"}),": use ",(0,i.jsx)(n.code,{children:"@queue/"})," decorators to subscribe class methods to a topic."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Typed topics"}),": declare topics via module augmentation to get end\u2011to\u2011end type safety."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Simple publishing"}),": call ",(0,i.jsx)(n.code,{children:"publish(provider, topic, payload)"})," or shortcuts like ",(0,i.jsx)(n.code,{children:"publish.bullmq"}),"/",(0,i.jsx)(n.code,{children:"publish.sqs"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Autoload handlers"}),": import handlers with glob patterns and start subscribers via ",(0,i.jsx)(n.code,{children:"QueueService"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"core-building-blocks",children:"Core building blocks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"queue"})," decorator and shortcuts: ",(0,i.jsx)(n.code,{children:"queue.bullmq"}),", ",(0,i.jsx)(n.code,{children:"queue.sqs"}),", ",(0,i.jsx)(n.code,{children:"queue.pgboss"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"publish"})," function and shortcuts: ",(0,i.jsx)(n.code,{children:"publish.bullmq"}),", ",(0,i.jsx)(n.code,{children:"publish.sqs"}),", ",(0,i.jsx)(n.code,{children:"publish.pgboss"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"defineQueueConfiguration"})," single entrypoint to configure built-in and custom providers."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"QueueService"})," (optional) to register and start consumers manually without decorators."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"quick-start",children:"Quick start"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Define your topics once:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"declare module 'balda' {\n  export interface QueueTopic {\n    test: { name: string };\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Create handlers using decorators:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { queue } from 'balda';\n\nexport class MyHandler {\n  @queue.bullmq('test')\n  async handle(payload: { name: string }) {\n    // process job\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Configure and start subscribers:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { QueueService, publish, defineQueueConfiguration } from 'balda';\n\n// Configure queue providers\ndefineQueueConfiguration({\n  bullmq: {\n    connection: { host: '127.0.0.1', username: 'default', password: 'root', db: 0 },\n  },\n});\n\n// Import queue handlers from glob patterns\nawait QueueService.massiveImportQueues(['src/queues/**/*.ts']);\n\n// Start queue subscribers\nawait QueueService.run();\n\nconsole.log('Queues started');\n\n// Publish a job\nawait publish.bullmq('test', { name: 'test' });\n"})}),"\n",(0,i.jsx)(n.p,{children:"Continue with configuration and publishing details in the next sections."}),"\n",(0,i.jsx)(n.h4,{id:"alternative-manual-import",children:"Alternative: Manual import"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// queue.ts\nimport { QueueService } from 'balda';\nimport path from 'node:path';\n\nQueueService.massiveImportQueues([path.join(import.meta.dirname, 'src/queues/**/*.ts')])\n  .then(() => {\n    QueueService.run().catch((error) => {\n      console.error('Error starting queues', error);\n    });\n  })\n  .catch((error) => {\n    console.error('Error importing queues', error);\n  });\n"})}),"\n",(0,i.jsx)(n.h4,{id:"registration-approaches",children:"Registration approaches"}),"\n",(0,i.jsx)(n.p,{children:"You can register consumers in two ways:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Decorators (recommended for most cases)"}),"\n",(0,i.jsx)(n.li,{children:"Static registration via the service class"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Static registration example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { QueueService } from 'balda';\n\ndeclare module 'balda' {\n  export interface QueueTopic {\n    test: { name: string };\n  }\n}\n\nQueueService.register(\n  'PlainHandler.handle',\n  'test',\n  async (payload: { name: string }) => {\n    console.log('Received', payload.name);\n  },\n  { provider: 'bullmq' }\n);\n\n// Ensure this file is imported before starting subscribers, e.g. via the same glob patterns\n"})})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);