"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5944],{6035:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>p,frontMatter:()=>r,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"plugins/file","title":"File Plugin","description":"Handles multipart/form-data file uploads with comprehensive security features. Automatically parses uploaded files, validates them, sanitizes filenames, and provides access through req.files and req.file.","source":"@site/docs/plugins/file.md","sourceDirName":"plugins","slug":"/plugins/file","permalink":"/balda-js/docs/plugins/file","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda-js/tree/main/docs/docs/plugins/file.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"docs","previous":{"title":"URL Encoded Plugin","permalink":"/balda-js/docs/plugins/urlencoded"},"next":{"title":"CORS Plugin","permalink":"/balda-js/docs/plugins/cors"}}');var s=i(4848),a=i(8453);const r={sidebar_position:10},t="File Plugin",o={},d=[{value:"Quick Start",id:"quick-start",level:2},{value:"Configuration",id:"configuration",level:2},{value:"maxFileSize",id:"maxfilesize",level:3},{value:"maxFiles",id:"maxfiles",level:3},{value:"allowedMimeTypes",id:"allowedmimetypes",level:3},{value:"Usage",id:"usage",level:2},{value:"Single File Upload",id:"single-file-upload",level:3},{value:"Multiple Files Upload",id:"multiple-files-upload",level:3},{value:"HTML Form Example",id:"html-form-example",level:3},{value:"File Object",id:"file-object",level:2},{value:"Security Features",id:"security-features",level:2},{value:"Filename Sanitization",id:"filename-sanitization",level:3},{value:"Cryptographically Secure Temporary Files",id:"cryptographically-secure-temporary-files",level:3},{value:"Automatic Cleanup",id:"automatic-cleanup",level:3},{value:"Error Responses",id:"error-responses",level:2},{value:"File Too Large",id:"file-too-large",level:3},{value:"Too Many Files",id:"too-many-files",level:3},{value:"Invalid MIME Type",id:"invalid-mime-type",level:3},{value:"Missing Content-Type",id:"missing-content-type",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Image Upload with Validation",id:"image-upload-with-validation",level:3},{value:"Document Upload",id:"document-upload",level:3},{value:"Profile Picture Upload",id:"profile-picture-upload",level:3},{value:"Performance Tips",id:"performance-tips",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"file-plugin",children:"File Plugin"})}),"\n",(0,s.jsxs)(n.p,{children:["Handles multipart/form-data file uploads with comprehensive security features. Automatically parses uploaded files, validates them, sanitizes filenames, and provides access through ",(0,s.jsx)(n.code,{children:"req.files"})," and ",(0,s.jsx)(n.code,{children:"req.file"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\n\nconst server = new Server({\n  plugins: {\n    file: {\n      maxFileSize: '5mb'\n    }\n  }\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["All options are optional. Defaults: ",(0,s.jsx)(n.code,{children:'maxFileSize: "1mb"'}),", ",(0,s.jsx)(n.code,{children:"maxFiles: 10"}),", ",(0,s.jsx)(n.code,{children:"allowedMimeTypes: []"})," (all types)."]}),"\n",(0,s.jsx)(n.h3,{id:"maxfilesize",children:"maxFileSize"}),"\n",(0,s.jsx)(n.p,{children:"Maximum size for each uploaded file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  maxFileSize: '5mb'     // 5 megabytes (default: 1mb)\n}\n\nfile: {\n  maxFileSize: '500kb'   // 500 kilobytes\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"maxfiles",children:"maxFiles"}),"\n",(0,s.jsx)(n.p,{children:"Maximum number of files per request:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  maxFiles: 3  // Default: 10\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"allowedmimetypes",children:"allowedMimeTypes"}),"\n",(0,s.jsx)(n.p,{children:"Whitelist of allowed MIME types:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  allowedMimeTypes: [\n    'image/jpeg',\n    'image/png',\n    'image/gif',\n    'application/pdf'\n  ]\n}\n\n// Empty array (default) allows all MIME types\nfile: {\n  allowedMimeTypes: []\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.h3,{id:"single-file-upload",children:"Single File Upload"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@controller('/api')\nexport class UploadController {\n  @post('/upload')\n  async uploadFile(req: Request, res: Response) {\n    const file = req.file;  // Single file\n\n    if (!file) {\n      return res.badRequest({ error: 'No file uploaded' });\n    }\n\n    res.json({\n      filename: file.filename,\n      originalFilename: file.originalFilename,\n      size: file.size,\n      mimeType: file.mimeType,\n      path: file.path\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"multiple-files-upload",children:"Multiple Files Upload"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@post('/upload/multiple')\nasync uploadMultiple(req: Request, res: Response) {\n  const files = req.files;  // Array of files\n\n  if (!files || files.length === 0) {\n    return res.badRequest({ error: 'No files uploaded' });\n  }\n\n  const fileInfos = files.map(f => ({\n    filename: f.filename,\n    size: f.size,\n    mimeType: f.mimeType\n  }));\n\n  res.json({ files: fileInfos });\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"html-form-example",children:"HTML Form Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<form action="/api/upload" method="POST" enctype="multipart/form-data">\n  <input type="file" name="file" />\n  <button type="submit">Upload</button>\n</form>\n\n\x3c!-- Multiple files --\x3e\n<form action="/api/upload/multiple" method="POST" enctype="multipart/form-data">\n  <input type="file" name="files" multiple />\n  <button type="submit">Upload Files</button>\n</form>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"file-object",children:"File Object"}),"\n",(0,s.jsx)(n.p,{children:"Each file object contains:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'{\n  filename: string;           // Sanitized filename (e.g., "avatar.png")\n  originalFilename: string;   // Original uploaded filename\n  path: string;              // Temporary file path\n  size: number;              // File size in bytes\n  mimeType: string;          // MIME type (e.g., "image/png")\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"security-features",children:"Security Features"}),"\n",(0,s.jsx)(n.h3,{id:"filename-sanitization",children:"Filename Sanitization"}),"\n",(0,s.jsx)(n.p,{children:"Automatically removes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Path traversal (",(0,s.jsx)(n.code,{children:"../"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Directory separators (",(0,s.jsx)(n.code,{children:"/"}),", ",(0,s.jsx)(n.code,{children:"\\"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Null bytes"}),"\n",(0,s.jsx)(n.li,{children:"Control characters"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Input: "../../../etc/passwd"\n// Sanitized: "etcpasswd"\n\n// Input: "file\\x00.txt"\n// Sanitized: "file.txt"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"cryptographically-secure-temporary-files",children:"Cryptographically Secure Temporary Files"}),"\n",(0,s.jsx)(n.p,{children:"Temporary files use UUID-based filenames to prevent:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Filename collisions"}),"\n",(0,s.jsx)(n.li,{children:"Predictable paths"}),"\n",(0,s.jsx)(n.li,{children:"Overwriting attacks"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"automatic-cleanup",children:"Automatic Cleanup"}),"\n",(0,s.jsx)(n.p,{children:"Temporary files are automatically deleted after request completion, even if errors occur."}),"\n",(0,s.jsx)(n.h2,{id:"error-responses",children:"Error Responses"}),"\n",(0,s.jsx)(n.h3,{id:"file-too-large",children:"File Too Large"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Response: 413 Payload Too Large\n{\n  "error": "File size exceeds limit"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"too-many-files",children:"Too Many Files"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Too many files. Maximum 10 allowed"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"invalid-mime-type",children:"Invalid MIME Type"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Invalid file type. Allowed: image/jpeg, image/png"\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"missing-content-type",children:"Missing Content-Type"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'// Response: 400 Bad Request\n{\n  "error": "Content-Type must be multipart/form-data"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const server = new Server({\n  plugins: {\n    file: {\n      maxFileSize: '10mb',\n      maxFiles: 5,\n      allowedMimeTypes: [\n        'image/jpeg',\n        'image/png',\n        'image/gif',\n        'application/pdf'\n      ]\n    }\n  }\n});\n\n@controller('/api')\nexport class FileController {\n  @post('/upload')\n  async handleUpload(req: Request, res: Response) {\n    const file = req.file;\n\n    if (!file) {\n      return res.badRequest({ error: 'No file provided' });\n    }\n\n    // Process file (e.g., move to permanent storage)\n    await moveFile(file.path, `uploads/${file.filename}`);\n\n    res.json({\n      success: true,\n      filename: file.filename,\n      size: file.size\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,s.jsx)(n.h3,{id:"image-upload-with-validation",children:"Image Upload with Validation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  maxFileSize: '5mb',\n  maxFiles: 1,\n  allowedMimeTypes: ['image/jpeg', 'image/png', 'image/webp']\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"document-upload",children:"Document Upload"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  maxFileSize: '10mb',\n  maxFiles: 3,\n  allowedMimeTypes: [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n  ]\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"profile-picture-upload",children:"Profile Picture Upload"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"file: {\n  maxFileSize: '2mb',\n  maxFiles: 1,\n  allowedMimeTypes: ['image/jpeg', 'image/png']\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Set reasonable ",(0,s.jsx)(n.code,{children:"maxFileSize"})," limits"]}),"\n",(0,s.jsxs)(n.li,{children:["Use ",(0,s.jsx)(n.code,{children:"allowedMimeTypes"})," to prevent unwanted files"]}),"\n",(0,s.jsx)(n.li,{children:"Store files in object storage (S3, etc.) for production"}),"\n",(0,s.jsx)(n.li,{children:"Consider using streaming for very large files"}),"\n",(0,s.jsx)(n.li,{children:"Validate file contents, not just MIME types"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var l=i(6540);const s={},a=l.createContext(s);function r(e){const n=l.useContext(a);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(a.Provider,{value:n},e.children)}}}]);