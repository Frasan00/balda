"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3601],{8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var s=n(6540);const d={},t=s.createContext(d);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:o(e.components),s.createElement(t.Provider,{value:r},e.children)}},8907:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"core-concepts/error-handling","title":"Error Handling","description":"Balda provides intelligent error handling out of the box, following HTTP specifications (RFC 7231) for proper status codes and security best practices for error responses.","source":"@site/docs/core-concepts/error-handling.md","sourceDirName":"core-concepts","slug":"/core-concepts/error-handling","permalink":"/balda/docs/core-concepts/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/core-concepts/error-handling.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9},"sidebar":"docs","previous":{"title":"Policies","permalink":"/balda/docs/core-concepts/policies"},"next":{"title":"WebSockets","permalink":"/balda/docs/websockets/overview"}}');var d=n(4848),t=n(8453);const o={sidebar_position:9},i="Error Handling",l={},c=[{value:"Error Response Format",id:"error-response-format",level:2},{value:"Why Stack Traces Are Hidden in Production",id:"why-stack-traces-are-hidden-in-production",level:3},{value:"404 Not Found",id:"404-not-found",level:2},{value:"Custom Not Found Handler",id:"custom-not-found-handler",level:3},{value:"405 Method Not Allowed",id:"405-method-not-allowed",level:2},{value:"Multiple Allowed Methods",id:"multiple-allowed-methods",level:3},{value:"Route Matching Priority",id:"route-matching-priority",level:2},{value:"Global Error Handler",id:"global-error-handler",level:2},{value:"Built-in Error Types",id:"built-in-error-types",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Always Set NODE_ENV in Production",id:"1-always-set-node_env-in-production",level:3},{value:"2. Use Specific Error Handlers",id:"2-use-specific-error-handlers",level:3},{value:"3. Provide Helpful 404 Responses",id:"3-provide-helpful-404-responses",level:3},{value:"4. Log Errors for Debugging",id:"4-log-errors-for-debugging",level:3},{value:"HTTP Status Code Reference",id:"http-status-code-reference",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.header,{children:(0,d.jsx)(r.h1,{id:"error-handling",children:"Error Handling"})}),"\n",(0,d.jsx)(r.p,{children:"Balda provides intelligent error handling out of the box, following HTTP specifications (RFC 7231) for proper status codes and security best practices for error responses."}),"\n",(0,d.jsx)(r.h2,{id:"error-response-format",children:"Error Response Format"}),"\n",(0,d.jsx)(r.p,{children:"All error responses follow a standardized format:"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:'// Development (NODE_ENV !== \'production\')\n{\n  "code": "ROUTE_NOT_FOUND",\n  "message": "ROUTE_NOT_FOUND: Cannot GET /unknown",\n  "stack": "Error: ROUTE_NOT_FOUND...",\n  "cause": undefined\n}\n\n// Production (NODE_ENV === \'production\')\n{\n  "code": "ROUTE_NOT_FOUND",\n  "message": "ROUTE_NOT_FOUND: Cannot GET /unknown"\n}\n'})}),"\n",(0,d.jsx)(r.h3,{id:"why-stack-traces-are-hidden-in-production",children:"Why Stack Traces Are Hidden in Production"}),"\n",(0,d.jsx)(r.p,{children:"Stack traces can expose sensitive information:"}),"\n",(0,d.jsxs)(r.ul,{children:["\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"Internal file paths"}),": ",(0,d.jsx)(r.code,{children:"/home/app/src/server/server.ts"})]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"Code structure"}),": Function names and middleware chains"]}),"\n",(0,d.jsxs)(r.li,{children:[(0,d.jsx)(r.strong,{children:"Framework internals"}),": How your application processes requests"]}),"\n"]}),"\n",(0,d.jsx)(r.p,{children:"This information could help attackers understand your application structure and find vulnerabilities."}),"\n",(0,d.jsx)(r.h2,{id:"404-not-found",children:"404 Not Found"}),"\n",(0,d.jsxs)(r.p,{children:["When a request is made to a path that doesn't exist for ",(0,d.jsx)(r.strong,{children:"any"})," HTTP method, Balda returns a ",(0,d.jsx)(r.code,{children:"404 Not Found"})," response."]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:'// No routes defined for /unknown\n// Request: GET /unknown\n// Response: 404 Not Found\n\n{\n  "code": "RouteNotFoundError",\n  "message": "ROUTE_NOT_FOUND: Cannot GET /unknown"\n}\n'})}),"\n",(0,d.jsx)(r.h3,{id:"custom-not-found-handler",children:"Custom Not Found Handler"}),"\n",(0,d.jsxs)(r.p,{children:["You can customize the 404 response using ",(0,d.jsx)(r.code,{children:"setNotFoundHandler"}),":"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst server = new Server({ port: 3000 });\n\nserver.setNotFoundHandler((req, res) => {\n  res.status(404).json({\n    error: 'Page not found',\n    path: new URL(req.url).pathname,\n    suggestion: 'Check the API documentation at /docs'\n  });\n});\n\nserver.listen();\n"})}),"\n",(0,d.jsx)(r.h2,{id:"405-method-not-allowed",children:"405 Method Not Allowed"}),"\n",(0,d.jsxs)(r.p,{children:["When a request is made to a path that ",(0,d.jsx)(r.strong,{children:"exists"})," but with a different HTTP method, Balda returns a ",(0,d.jsx)(r.code,{children:"405 Method Not Allowed"})," response with an ",(0,d.jsx)(r.code,{children:"Allow"})," header listing the valid methods."]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst server = new Server({ port: 3000 });\n\n// Only POST is allowed for /users\nserver.post('/users', (req, res) => {\n  res.created({ id: 1, ...req.body });\n});\n\nserver.listen();\n"})}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-bash",children:'# Request: GET /users\n# Response: 405 Method Not Allowed\n# Headers: Allow: POST\n\n{\n  "code": "MethodNotAllowedError",\n  "message": "METHOD_NOT_ALLOWED: Cannot GET /users"\n}\n'})}),"\n",(0,d.jsx)(r.h3,{id:"multiple-allowed-methods",children:"Multiple Allowed Methods"}),"\n",(0,d.jsxs)(r.p,{children:["If a path is registered with multiple methods, all valid methods are listed in the ",(0,d.jsx)(r.code,{children:"Allow"})," header:"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"server.get('/users', (req, res) => {\n  res.json({ users: [] });\n});\n\nserver.post('/users', (req, res) => {\n  res.created(req.body);  // Automatically parsed when using body parser middleware\n});\n\n// Request: DELETE /users\n// Response: 405 Method Not Allowed\n// Headers: Allow: GET, POST\n"})}),"\n",(0,d.jsx)(r.h2,{id:"route-matching-priority",children:"Route Matching Priority"}),"\n",(0,d.jsx)(r.p,{children:"Balda uses a radix trie router with the following matching priority:"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Priority"}),(0,d.jsx)(r.th,{children:"Type"}),(0,d.jsx)(r.th,{children:"Example"}),(0,d.jsx)(r.th,{children:"Description"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"1st"}),(0,d.jsx)(r.td,{children:"Static"}),(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"/users"})}),(0,d.jsx)(r.td,{children:"Exact path match"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"2nd"}),(0,d.jsx)(r.td,{children:"Parameterized"}),(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"/users/:id"})}),(0,d.jsx)(r.td,{children:"Dynamic segments"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:"3rd"}),(0,d.jsx)(r.td,{children:"Wildcard"}),(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"*"})}),(0,d.jsx)(r.td,{children:"Catch-all (404/405 handler)"})]})]})]}),"\n",(0,d.jsx)(r.p,{children:"This ensures that specific routes always take precedence over catch-all handlers."}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"server.get('/users', handler);        // Matches GET /users\nserver.get('/users/:id', handler);    // Matches GET /users/123\n// Wildcard catch-all handles everything else (404/405)\n"})}),"\n",(0,d.jsx)(r.h2,{id:"global-error-handler",children:"Global Error Handler"}),"\n",(0,d.jsxs)(r.p,{children:["For handling errors thrown during request processing, use ",(0,d.jsx)(r.code,{children:"setErrorHandler"}),":"]}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"import { Server } from 'balda';\n\nconst server = new Server({ port: 3000 });\n\nserver.setErrorHandler((req, res, next, error) => {\n  console.error('Request error:', error);\n\n  // Handle specific error types\n  if (error.name === 'ValidationError') {\n    return res.badRequest({\n      code: 'VALIDATION_ERROR',\n      message: error.message\n    });\n  }\n\n  if (error.name === 'UnauthorizedError') {\n    return res.unauthorized({\n      code: 'UNAUTHORIZED',\n      message: 'Authentication required'\n    });\n  }\n\n  // Default error response\n  res.internalServerError({\n    code: 'INTERNAL_ERROR',\n    message: 'An unexpected error occurred'\n  });\n});\n\nserver.listen();\n"})}),"\n",(0,d.jsx)(r.h2,{id:"built-in-error-types",children:"Built-in Error Types"}),"\n",(0,d.jsx)(r.p,{children:"Balda provides several built-in error types:"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Error"}),(0,d.jsx)(r.th,{children:"Status"}),(0,d.jsx)(r.th,{children:"Description"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"RouteNotFoundError"})}),(0,d.jsx)(r.td,{children:"404"}),(0,d.jsx)(r.td,{children:"Path doesn't exist for any method"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"MethodNotAllowedError"})}),(0,d.jsx)(r.td,{children:"405"}),(0,d.jsx)(r.td,{children:"Path exists but not for requested method"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"JsonNotValidError"})}),(0,d.jsx)(r.td,{children:"400"}),(0,d.jsx)(r.td,{children:"Invalid JSON in request body"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"FileTooLargeError"})}),(0,d.jsx)(r.td,{children:"413"}),(0,d.jsx)(r.td,{children:"Uploaded file exceeds size limit"})]})]})]}),"\n",(0,d.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,d.jsx)(r.h3,{id:"1-always-set-node_env-in-production",children:"1. Always Set NODE_ENV in Production"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-bash",children:"NODE_ENV=production node server.js\n"})}),"\n",(0,d.jsx)(r.p,{children:"This ensures stack traces are never exposed to clients."}),"\n",(0,d.jsx)(r.h3,{id:"2-use-specific-error-handlers",children:"2. Use Specific Error Handlers"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"server.setErrorHandler((req, res, next, error) => {\n  // Log the full error internally\n  console.error({\n    error: error.message,\n    stack: error.stack,\n    path: req.url,\n    method: req.method\n  });\n\n  // Return safe response to client\n  res.internalServerError({\n    code: 'INTERNAL_ERROR',\n    message: 'Something went wrong'\n  });\n});\n"})}),"\n",(0,d.jsx)(r.h3,{id:"3-provide-helpful-404-responses",children:"3. Provide Helpful 404 Responses"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"server.setNotFoundHandler((req, res) => {\n  const pathname = new URL(req.url).pathname;\n\n  res.status(404).json({\n    code: 'NOT_FOUND',\n    message: `The endpoint ${pathname} does not exist`,\n    docs: '/api/docs'\n  });\n});\n"})}),"\n",(0,d.jsx)(r.h3,{id:"4-log-errors-for-debugging",children:"4. Log Errors for Debugging"}),"\n",(0,d.jsx)(r.pre,{children:(0,d.jsx)(r.code,{className:"language-typescript",children:"server.setErrorHandler((req, res, next, error) => {\n  // Use your logging service\n  logger.error({\n    requestId: req.id,\n    error: error.message,\n    stack: error.stack,\n    url: req.url,\n    method: req.method\n  });\n\n  res.internalServerError({\n    code: 'INTERNAL_ERROR',\n    requestId: req.id  // Include for support reference\n  });\n});\n"})}),"\n",(0,d.jsx)(r.h2,{id:"http-status-code-reference",children:"HTTP Status Code Reference"}),"\n",(0,d.jsxs)(r.table,{children:[(0,d.jsx)(r.thead,{children:(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.th,{children:"Status"}),(0,d.jsx)(r.th,{children:"Method"}),(0,d.jsx)(r.th,{children:"Description"})]})}),(0,d.jsxs)(r.tbody,{children:[(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.badRequest()"})}),(0,d.jsx)(r.td,{children:"400"}),(0,d.jsx)(r.td,{children:"Invalid request syntax"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.unauthorized()"})}),(0,d.jsx)(r.td,{children:"401"}),(0,d.jsx)(r.td,{children:"Authentication required"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.forbidden()"})}),(0,d.jsx)(r.td,{children:"403"}),(0,d.jsx)(r.td,{children:"Access denied"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.notFound()"})}),(0,d.jsx)(r.td,{children:"404"}),(0,d.jsx)(r.td,{children:"Resource not found"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.methodNotAllowed()"})}),(0,d.jsx)(r.td,{children:"405"}),(0,d.jsx)(r.td,{children:"HTTP method not supported"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.conflict()"})}),(0,d.jsx)(r.td,{children:"409"}),(0,d.jsx)(r.td,{children:"Resource conflict"})]}),(0,d.jsxs)(r.tr,{children:[(0,d.jsx)(r.td,{children:(0,d.jsx)(r.code,{children:"res.internalServerError()"})}),(0,d.jsx)(r.td,{children:"500"}),(0,d.jsx)(r.td,{children:"Server error"})]})]})]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,d.jsx)(r,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);