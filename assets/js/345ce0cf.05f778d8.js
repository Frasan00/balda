"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5682],{2442:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"examples/rest-api","title":"REST API Example","description":"A complete REST API example with authentication, validation, and services.","source":"@site/docs/examples/rest-api.md","sourceDirName":"examples","slug":"/examples/rest-api","permalink":"/balda/docs/examples/rest-api","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/examples/rest-api.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Swagger Plugin","permalink":"/balda/docs/plugins/swagger"},"next":{"title":"Testing Overview","permalink":"/balda/docs/testing/overview"}}');var t=n(4848),i=n(8453);const a={sidebar_position:1},o="REST API Example",l={},c=[{value:"Project Structure",id:"project-structure",level:2},{value:"Server Setup",id:"server-setup",level:2},{value:"Schemas",id:"schemas",level:2},{value:"Service",id:"service",level:2},{value:"Middleware",id:"middleware",level:2},{value:"Controller",id:"controller",level:2},{value:"Testing",id:"testing",level:2},{value:"Key Takeaways",id:"key-takeaways",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"rest-api-example",children:"REST API Example"})}),"\n",(0,t.jsx)(r.p,{children:"A complete REST API example with authentication, validation, and services."}),"\n",(0,t.jsx)(r.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"src/\n\u251c\u2500\u2500 controllers/\n\u2502   \u2514\u2500\u2500 users.controller.ts\n\u251c\u2500\u2500 middleware/\n\u2502   \u2514\u2500\u2500 auth.middleware.ts\n\u251c\u2500\u2500 schemas/\n\u2502   \u2514\u2500\u2500 user.schema.ts\n\u251c\u2500\u2500 services/\n\u2502   \u2514\u2500\u2500 user.service.ts\n\u2514\u2500\u2500 server.ts\n"})}),"\n",(0,t.jsx)(r.h2,{id:"server-setup",children:"Server Setup"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// src/server.ts\nimport { Server } from 'balda';\n\nconst server = new Server({\n  port: 3000,\n  controllerPatterns: ['./src/controllers/**/*.ts'],\n  plugins: {\n    cors: { origin: '*' },\n    bodyParser: { json: { sizeLimit: '10mb' } },\n  },\n});\n\nserver.setErrorHandler((req, res, next, error) => {\n  if (error.name === 'ValidationError') {\n    return res.badRequest({ error: error.message });\n  }\n  res.internalServerError({ error: 'Server error' });\n});\n\nserver.listen(({ port }) => {\n  console.log(`Server running on http://localhost:${port}`);\n});\n"})}),"\n",(0,t.jsx)(r.h2,{id:"schemas",children:"Schemas"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// src/schemas/user.schema.ts\nimport { z } from 'zod';\n\nexport const CreateUserSchema = z.object({\n  name: z.string().min(1),\n  email: z.string().email(),\n  password: z.string().min(8),\n});\n\nexport const UpdateUserSchema = CreateUserSchema.partial();\n\nexport const UserSchema = z.object({\n  id: z.number(),\n  name: z.string(),\n  email: z.string(),\n});\n\nexport const LoginSchema = z.object({\n  email: z.string().email(),\n  password: z.string(),\n});\n\nexport type CreateUser = z.infer<typeof CreateUserSchema>;\nexport type User = z.infer<typeof UserSchema>;\n"})}),"\n",(0,t.jsx)(r.h2,{id:"service",children:"Service"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// src/services/user.service.ts\nimport { User, CreateUser } from '../schemas/user.schema';\n\nclass UserService {\n  private users: User[] = [];\n  private nextId = 1;\n\n  async findAll(): Promise<User[]> {\n    return this.users;\n  }\n\n  async findById(id: number): Promise<User | null> {\n    return this.users.find(u => u.id === id) || null;\n  }\n\n  async findByEmail(email: string): Promise<User | null> {\n    return this.users.find(u => u.email === email) || null;\n  }\n\n  async create(data: CreateUser): Promise<User> {\n    if (await this.findByEmail(data.email)) {\n      throw new Error('Email already exists');\n    }\n\n    const user: User = {\n      id: this.nextId++,\n      name: data.name,\n      email: data.email,\n    };\n\n    this.users.push(user);\n    return user;\n  }\n\n  async delete(id: number): Promise<boolean> {\n    const index = this.users.findIndex(u => u.id === id);\n    if (index === -1) return false;\n\n    this.users.splice(index, 1);\n    return true;\n  }\n}\n\nexport const userService = new UserService();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"middleware",children:"Middleware"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// src/middleware/auth.middleware.ts\nimport { userService } from '../services/user.service';\n\nexport const authMiddleware = async (req, res, next) => {\n  const token = req.headers.authorization?.replace('Bearer ', '');\n\n  if (!token) {\n    return res.unauthorized({ error: 'Token required' });\n  }\n\n  try {\n    // In production, verify JWT token\n    // For demo, using user ID as token\n    const user = await userService.findById(Number(token));\n\n    if (!user) {\n      return res.unauthorized({ error: 'Invalid token' });\n    }\n\n    req.user = user;\n    next();\n  } catch {\n    return res.unauthorized({ error: 'Invalid token' });\n  }\n};\n"})}),"\n",(0,t.jsx)(r.h2,{id:"controller",children:"Controller"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// src/controllers/users.controller.ts\nimport { controller, get, post, del, validate, serialize, middleware } from 'balda';\nimport { z } from 'zod';\nimport { CreateUserSchema, UserSchema, LoginSchema } from '../schemas/user.schema';\nimport { userService } from '../services/user.service';\nimport { authMiddleware } from '../middleware/auth.middleware';\n\n@controller('/users')\nexport class UsersController {\n  @get('/')\n  @serialize(z.array(UserSchema))\n  async getAll(req, res) {\n    const users = await userService.findAll();\n    res.json(users);\n  }\n\n  @get('/:id')\n  @serialize(UserSchema)\n  async getById(req, res) {\n    const user = await userService.findById(Number(req.params.id));\n    user ? res.json(user) : res.notFound({ error: 'User not found' });\n  }\n\n  @post('/')\n  @validate.body(CreateUserSchema)\n  @serialize(UserSchema)\n  async create(req, res, body) {\n    try {\n      const user = await userService.create(body);\n      res.created(user);\n    } catch (error) {\n      return res.conflict({ error: error.message });\n    }\n  }\n\n  @del('/:id')\n  @middleware(authMiddleware)\n  async delete(req, res) {\n    const id = Number(req.params.id);\n\n    if (req.user.id !== id) {\n      return res.forbidden({ error: 'Cannot delete other users' });\n    }\n\n    const deleted = await userService.delete(id);\n    deleted ? res.noContent() : res.notFound({ error: 'User not found' });\n  }\n\n  @post('/login')\n  @validate.body(LoginSchema)\n  async login(req, res, body) {\n    const user = await userService.findByEmail(body.email);\n\n    if (!user) {\n      return res.unauthorized({ error: 'Invalid credentials' });\n    }\n\n    // In production, verify password hash\n    res.json({\n      token: user.id.toString(),\n      user\n    });\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"testing",children:"Testing"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'# Create user\ncurl -X POST http://localhost:3000/users \\\n  -H "Content-Type: application/json" \\\n  -d \'{"name":"Alice","email":"alice@example.com","password":"password123"}\'\n\n# Login\ncurl -X POST http://localhost:3000/users/login \\\n  -H "Content-Type: application/json" \\\n  -d \'{"email":"alice@example.com","password":"password123"}\'\n\n# Get all users\ncurl http://localhost:3000/users\n\n# Delete user (requires auth)\ncurl -X DELETE http://localhost:3000/users/1 \\\n  -H "Authorization: Bearer 1"\n'})}),"\n",(0,t.jsx)(r.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Controllers"})," organize routes by feature"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Services"})," handle business logic and data access"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Middleware"})," adds cross-cutting concerns like authentication"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Validation"})," ensures request data integrity with Zod schemas"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Serialization"})," defines response structure and generates OpenAPI docs"]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["See ",(0,t.jsx)(r.a,{href:"../core-concepts/server",children:"Core Concepts"})," for more details on each component."]})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>a,x:()=>o});var s=n(6540);const t={},i=s.createContext(t);function a(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);