"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8868],{8453:(e,s,r)=>{r.d(s,{R:()=>d,x:()=>l});var n=r(6540);const i={},t=n.createContext(i);function d(e){const s=n.useContext(t);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),n.createElement(t.Provider,{value:s},e.children)}},9899:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>d,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"express/overview","title":"Express Compatibility","description":"Balda.js provides an Express compatibility layer that allows you to integrate Express-based libraries like AdminJS, Passport, and other Express middleware into your Balda application.","source":"@site/docs/express/overview.md","sourceDirName":"express","slug":"/express/overview","permalink":"/balda-js/docs/express/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda-js/tree/main/docs/docs/express/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"providers","permalink":"/balda-js/docs/queues/providers"}}');var i=r(4848),t=r(8453);const d={sidebar_position:1},l="Express Compatibility",o={},a=[{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Mounting an Express Router",id:"mounting-an-express-router",level:3},{value:"Using Express Middleware",id:"using-express-middleware",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"<code>server.useExpress(middleware)</code>",id:"serveruseexpressmiddleware",level:3},{value:"<code>server.useExpress(path, middleware)</code>",id:"serveruseexpresspath-middleware",level:3},{value:"<code>server.mountExpressRouter(basePath, router)</code>",id:"servermountexpressrouterbasepath-router",level:3},{value:"<code>server.expressMiddleware(middleware)</code>",id:"serverexpressmiddlewaremiddleware",level:3},{value:"Standalone Functions",id:"standalone-functions",level:2},{value:"Common Use Cases",id:"common-use-cases",level:2},{value:"AdminJS Integration",id:"adminjs-integration",level:3},{value:"Passport.js Authentication",id:"passportjs-authentication",level:3},{value:"Multiple Express Routers",id:"multiple-express-routers",level:3},{value:"Limitations",id:"limitations",level:2},{value:"Not Supported",id:"not-supported",level:3},{value:"Partial Support",id:"partial-support",level:3},{value:"Recommended Approach",id:"recommended-approach",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"HTML Not Rendering",id:"html-not-rendering",level:3},{value:"Middleware Not Executing",id:"middleware-not-executing",level:3},{value:"Cookie/Session Issues",id:"cookiesession-issues",level:3},{value:"Runtime Support",id:"runtime-support",level:2}];function c(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"express-compatibility",children:"Express Compatibility"})}),"\n",(0,i.jsxs)(s.p,{children:["Balda.js provides an Express compatibility layer that allows you to integrate Express-based libraries like ",(0,i.jsx)(s.strong,{children:"AdminJS"}),", ",(0,i.jsx)(s.strong,{children:"Passport"}),", and other Express middleware into your Balda application."]}),"\n",(0,i.jsx)(s.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(s.p,{children:"Install the Express types for TypeScript support:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"npm install express\nnpm install -D @types/express\n"})}),"\n",(0,i.jsx)(s.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(s.h3,{id:"mounting-an-express-router",children:"Mounting an Express Router"}),"\n",(0,i.jsxs)(s.p,{children:["Use ",(0,i.jsx)(s.code,{children:"mountExpressRouter"})," to mount an entire Express router at a specific path:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\nimport AdminJS from 'adminjs';\nimport AdminJSExpress from '@adminjs/express';\n\nconst admin = new AdminJS({ resources: [] });\nconst adminRouter = AdminJSExpress.buildRouter(admin);\n\nconst server = new Server({ port: 3000 });\nserver.mountExpressRouter('/admin', adminRouter);\nserver.listen();\n"})}),"\n",(0,i.jsx)(s.h3,{id:"using-express-middleware",children:"Using Express Middleware"}),"\n",(0,i.jsxs)(s.p,{children:["Convert Express middleware to Balda middleware with ",(0,i.jsx)(s.code,{children:"useExpress"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\nimport helmet from 'helmet';\nimport compression from 'compression';\n\nconst server = new Server({ port: 3000 });\n\n// Mount middleware at root\nserver.useExpress(helmet());\n\n// Mount middleware at specific path\nserver.useExpress('/api', compression());\n\nserver.listen();\n"})}),"\n",(0,i.jsx)(s.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,i.jsx)(s.h3,{id:"serveruseexpressmiddleware",children:(0,i.jsx)(s.code,{children:"server.useExpress(middleware)"})}),"\n",(0,i.jsx)(s.p,{children:"Mount Express middleware or router at the root path."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"server.useExpress(someExpressMiddleware);\nserver.useExpress(someExpressRouter);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"serveruseexpresspath-middleware",children:(0,i.jsx)(s.code,{children:"server.useExpress(path, middleware)"})}),"\n",(0,i.jsx)(s.p,{children:"Mount Express middleware or router at a specific path."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"server.useExpress('/admin', adminRouter);\nserver.useExpress('/api', apiMiddleware);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"servermountexpressrouterbasepath-router",children:(0,i.jsx)(s.code,{children:"server.mountExpressRouter(basePath, router)"})}),"\n",(0,i.jsx)(s.p,{children:"Directly mount an Express router, extracting all routes."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"server.mountExpressRouter('/admin', adminJsRouter);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"serverexpressmiddlewaremiddleware",children:(0,i.jsx)(s.code,{children:"server.expressMiddleware(middleware)"})}),"\n",(0,i.jsxs)(s.p,{children:["Convert an Express middleware to a ",(0,i.jsx)(s.strong,{children:"Balda-compatible middleware"})," (",(0,i.jsx)(s.code,{children:"ServerRouteMiddleware"}),") for use with ",(0,i.jsx)(s.code,{children:"server.use()"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Returns:"})," ",(0,i.jsx)(s.code,{children:"ServerRouteMiddleware"})," - A Balda-native middleware function"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const baldaMiddleware = server.expressMiddleware(someExpressMiddleware);\nserver.use(baldaMiddleware);\n"})}),"\n",(0,i.jsx)(s.h2,{id:"standalone-functions",children:"Standalone Functions"}),"\n",(0,i.jsx)(s.p,{children:"Import these directly for more control:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import {\n  createExpressAdapter,\n  expressMiddleware,\n  expressHandler,\n  mountExpressRouter,\n} from 'balda-js';\n\n// Create an adapter with custom server\nconst adapter = createExpressAdapter(server);\nadapter.use('/admin', adminRouter);\n\n// Convert Express middleware \u2192 Balda middleware (ServerRouteMiddleware)\nconst baldaMw = expressMiddleware(someExpressMiddleware);\n\n// Convert Express handler \u2192 Balda handler (ServerRouteHandler)\nconst baldaHandler = expressHandler(someExpressHandler);\n"})}),"\n",(0,i.jsx)(s.h2,{id:"common-use-cases",children:"Common Use Cases"}),"\n",(0,i.jsx)(s.h3,{id:"adminjs-integration",children:"AdminJS Integration"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\nimport AdminJS from 'adminjs';\nimport AdminJSExpress from '@adminjs/express';\nimport * as AdminJSSequelize from '@adminjs/sequelize';\n\nAdminJS.registerAdapter(AdminJSSequelize);\n\nconst admin = new AdminJS({\n  resources: [User, Post, Comment],\n  rootPath: '/admin',\n});\n\nconst adminRouter = AdminJSExpress.buildRouter(admin);\n\nconst server = new Server({ port: 3000 });\nserver.mountExpressRouter('/admin', adminRouter);\nserver.listen();\n"})}),"\n",(0,i.jsx)(s.h3,{id:"passportjs-authentication",children:"Passport.js Authentication"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\nimport passport from 'passport';\nimport { Strategy as LocalStrategy } from 'passport-local';\n\npassport.use(new LocalStrategy(/* ... */));\n\nconst server = new Server({ port: 3000 });\nserver.useExpress(passport.initialize());\nserver.useExpress(passport.session());\nserver.listen();\n"})}),"\n",(0,i.jsx)(s.h3,{id:"multiple-express-routers",children:"Multiple Express Routers"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"import { Server } from 'balda-js';\nimport { apiRouter, webhookRouter } from './express-routers';\n\nconst server = new Server({ port: 3000 });\nserver.mountExpressRouter('/api/v1', apiRouter);\nserver.mountExpressRouter('/webhooks', webhookRouter);\nserver.listen();\n"})}),"\n",(0,i.jsx)(s.h2,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsx)(s.admonition,{title:"Important Limitations",type:"warning",children:(0,i.jsx)(s.p,{children:"The Express compatibility layer has some limitations you should be aware of:"})}),"\n",(0,i.jsx)(s.h3,{id:"not-supported",children:"Not Supported"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Feature"}),(0,i.jsx)(s.th,{children:"Status"}),(0,i.jsx)(s.th,{children:"Notes"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"res.render()"})}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"Template engines not supported"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"app.engine()"})}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"View engines not available"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"app.set()"})," / ",(0,i.jsx)(s.code,{children:"app.get()"})," settings"]}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"Express app settings not implemented"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"res.sendFile()"})," streaming"]}),(0,i.jsx)(s.td,{children:"\u26a0\ufe0f"}),(0,i.jsx)(s.td,{children:"Works but no streaming callbacks"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"req.signedCookies"})}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"Use Balda's cookie plugin instead"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Express sub-apps"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsxs)(s.td,{children:["Nested ",(0,i.jsx)(s.code,{children:"app.use(app)"})," not supported"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Express error middleware"}),(0,i.jsx)(s.td,{children:"\u26a0\ufe0f"}),(0,i.jsxs)(s.td,{children:["4-argument ",(0,i.jsx)(s.code,{children:"(err, req, res, next)"})," partially supported"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"res.format()"})}),(0,i.jsx)(s.td,{children:"\u26a0\ufe0f"}),(0,i.jsx)(s.td,{children:"Returns empty, content negotiation not implemented"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Trust proxy inheritance"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsxs)(s.td,{children:["Use Balda's ",(0,i.jsx)(s.code,{children:"trustProxy"})," plugin"]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"partial-support",children:"Partial Support"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"res.redirect()"})})," - Works, but always uses 302 unless status explicitly set"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"res.cookie()"})})," - Requires Balda's cookie plugin to be enabled"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"File uploads"})," - Use Balda's ",(0,i.jsx)(s.code,{children:"fileParser"})," plugin, not multer"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Sessions"})," - Use Balda's session plugin, Express session middleware may not work"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"recommended-approach",children:"Recommended Approach"}),"\n",(0,i.jsx)(s.p,{children:"For best results, use Balda native features when possible and reserve the Express compatibility layer for third-party libraries:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// \u2705 Good: Use Express compat for third-party libraries\nserver.mountExpressRouter('/admin', adminJsRouter);\n\n// \u2705 Good: Use Balda native for your own routes\nserver.get('/api/users', (req, res) => {\n  res.json({ users: [] });\n});\n\n// \u274c Avoid: Don't use Express compat for simple middleware\n// server.useExpress(cors()); // Use Balda's cors plugin instead\nserver.use(cors({ origin: '*' })); // Native Balda\n"})}),"\n",(0,i.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(s.h3,{id:"html-not-rendering",children:"HTML Not Rendering"}),"\n",(0,i.jsxs)(s.p,{children:["If HTML appears as raw text, the Content-Type header may not be set. The adapter auto-detects HTML starting with ",(0,i.jsx)(s.code,{children:"<!DOCTYPE"})," or ",(0,i.jsx)(s.code,{children:"<html>"}),", but you can explicitly set it:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// In Express handler\nres.type('text/html').send(htmlContent);\n"})}),"\n",(0,i.jsx)(s.h3,{id:"middleware-not-executing",children:"Middleware Not Executing"}),"\n",(0,i.jsxs)(s.p,{children:["Ensure Express routers are mounted ",(0,i.jsx)(s.strong,{children:"before"})," calling ",(0,i.jsx)(s.code,{children:"server.listen()"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const server = new Server({ port: 3000 });\n\n// \u2705 Correct: Mount before listen\nserver.mountExpressRouter('/admin', adminRouter);\nserver.listen();\n\n// \u274c Wrong: Mounting after listen won't work correctly\n"})}),"\n",(0,i.jsx)(s.h3,{id:"cookiesession-issues",children:"Cookie/Session Issues"}),"\n",(0,i.jsx)(s.p,{children:"Enable Balda's cookie plugin for Express middleware that uses cookies:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"const server = new Server({\n  port: 3000,\n  plugins: {\n    cookie: {}, // Enable cookie parsing\n  },\n});\n"})}),"\n",(0,i.jsx)(s.h2,{id:"runtime-support",children:"Runtime Support"}),"\n",(0,i.jsx)(s.p,{children:"The Express compatibility layer works across all Balda-supported runtimes:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Runtime"}),(0,i.jsx)(s.th,{children:"Support"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Node.js"}),(0,i.jsx)(s.td,{children:"\u2705 Full"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Bun"}),(0,i.jsx)(s.td,{children:"\u2705 Full"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Deno"}),(0,i.jsx)(s.td,{children:"\u2705 Full"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Note: Some Express middleware may have runtime-specific dependencies that only work in Node.js."})]})}function p(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);