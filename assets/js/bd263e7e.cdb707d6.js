"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3777],{6806:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>c,frontMatter:()=>r,metadata:()=>o,toc:()=>u});const o=JSON.parse('{"id":"queues/providers","title":"providers","description":"Providers","source":"@site/docs/queues/providers.md","sourceDirName":"queues","slug":"/queues/providers","permalink":"/balda/docs/queues/providers","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/queues/providers.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docs","previous":{"title":"publishing","permalink":"/balda/docs/queues/publishing"},"next":{"title":"MQTT Overview","permalink":"/balda/docs/mqtt/overview"}}');var i=s(4848),a=s(8453);const r={sidebar_position:3},t=void 0,l={},u=[{value:"Providers",id:"providers",level:3},{value:"Single entrypoint configuration",id:"single-entrypoint-configuration",level:4},{value:"Best Practice: Centralized Queue Registry",id:"best-practice-centralized-queue-registry",level:4},{value:"BullMQ",id:"bullmq",level:4},{value:"SQS",id:"sqs",level:4},{value:"PGBoss",id:"pgboss",level:4},{value:"Custom provider",id:"custom-provider",level:4}];function d(e){const n={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"providers",children:"Providers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Balda Queue supports the following providers out of the box:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"BullMQ"}),"\n",(0,i.jsx)(n.li,{children:"SQS"}),"\n",(0,i.jsx)(n.li,{children:"PgBoss"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"You must also install the corresponding package for each provider:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["BullMQ: ",(0,i.jsx)(n.code,{children:"npm install bullmq ioredis"})]}),"\n",(0,i.jsxs)(n.li,{children:["SQS: ",(0,i.jsx)(n.code,{children:"npm install @aws-sdk/client-sqs sqs-consumer"})]}),"\n",(0,i.jsxs)(n.li,{children:["PgBoss: ",(0,i.jsx)(n.code,{children:"npm install pg-boss pg"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["It's also possible to support custom providers via the ",(0,i.jsx)(n.code,{children:"GenericPubSub"})," interface."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"single-entrypoint-configuration",children:"Single entrypoint configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"defineQueueConfiguration"})," to configure all providers in one place during app bootstrap:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { defineQueueConfiguration } from 'balda';\n\ndefineQueueConfiguration({\n  bullmq: {\n    connection: { host: '127.0.0.1', username: 'default', password: 'root', db: 0 },\n    defaultJobOptions: { removeOnComplete: 100, removeOnFail: 100 },\n  },\n  sqs: {\n    client: { region: 'us-east-1' },\n    consumer: {\n      queueUrlMap: { test: 'http://localhost:9324/queue/balda-development-test' },\n      batchSize: 10,\n    },\n  },\n  pgboss: {\n    connectionString: process.env.DATABASE_URL!,\n  },\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"best-practice-centralized-queue-registry",children:"Best Practice: Centralized Queue Registry"}),"\n",(0,i.jsx)(n.p,{children:"While not enforced, we recommend creating a centralized registry for all your queues. This provides a single source of truth and makes queue instances easily accessible throughout your application:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// src/queues/index.ts\nimport { bullmqQueue, sqsQueue, pgbossQueue } from 'balda';\n\n// Payload type definitions\ntype EmailPayload = { to: string; subject: string; body: string };\ntype OrderPayload = { orderId: number; total: number };\ntype NotificationPayload = { userId: string; message: string };\n\n// Centralized queue registry\nexport const queues = {\n  // BullMQ queues\n  emails: bullmqQueue<EmailPayload>('emails'),\n\n  // SQS queues\n  orders: sqsQueue<OrderPayload>('orders', {\n    queueUrl: 'https://sqs.us-east-1.amazonaws.com/123456789/orders'\n  }),\n\n  // PGBoss queues\n  notifications: pgbossQueue<NotificationPayload>('notifications'),\n} as const;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then use throughout your application:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { queues } from './queues/index.js';\n\n// In handlers\nexport class EmailHandler {\n  @queues.emails.subscribe()\n  async handle(payload: EmailPayload) {\n    // Send email\n  }\n}\n\n// In services\nawait queues.emails.publish({ to: 'user@example.com', subject: 'Welcome', body: 'Hello!' });\n"})}),"\n",(0,i.jsx)(n.h4,{id:"bullmq",children:"BullMQ"}),"\n",(0,i.jsx)(n.p,{children:"Create a typed BullMQ queue and subscribe to it using either decorators or callbacks:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { bullmqQueue } from 'balda';\n\ntype EmailPayload = {\n  to: string;\n  subject: string;\n  body: string;\n};\n\n// Create queue instance\nexport const emailQueue = bullmqQueue<EmailPayload>('emails');\n\n// Subscribe with decorator (recommended for class methods)\nexport class EmailHandler {\n  @emailQueue.subscribe()\n  async handle(payload: EmailPayload) {\n    console.log(`Sending email to ${payload.to}`);\n  }\n}\n\n// Or subscribe with callback (recommended for standalone functions)\nawait emailQueue.subscribe(async (payload) => {\n  console.log(`Sending email to ${payload.to}`);\n});\n\n// Publish\nawait emailQueue.publish({\n  to: 'user@example.com',\n  subject: 'Hello',\n  body: 'World'\n});\n"})}),"\n",(0,i.jsx)(n.h4,{id:"sqs",children:"SQS"}),"\n",(0,i.jsx)(n.p,{children:"Create a typed SQS queue with queue URL and subscribe using either method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { sqsQueue } from 'balda';\n\ntype OrderPayload = {\n  orderId: number;\n  total: number;\n};\n\n// Create queue instance with SQS options\nexport const orderQueue = sqsQueue<OrderPayload>('orders', {\n  queueUrl: 'https://sqs.us-east-1.amazonaws.com/123456789/my-queue'\n});\n\n// Subscribe with decorator\nexport class OrderHandler {\n  @orderQueue.subscribe()\n  async handle(payload: OrderPayload) {\n    console.log(`Processing order ${payload.orderId}`);\n  }\n}\n\n// Or subscribe with callback\nawait orderQueue.subscribe(async (payload) => {\n  console.log(`Processing order ${payload.orderId}`);\n});\n\n// Publish with SQS-specific options\nawait orderQueue.publish(\n  { orderId: 123, total: 99.99 },\n  {\n    MessageGroupId: 'orders',\n    DelaySeconds: 10\n  }\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note: You can either specify ",(0,i.jsx)(n.code,{children:"queueUrl"})," per queue instance (as shown above) or configure it globally in ",(0,i.jsx)(n.code,{children:"defineQueueConfiguration"})," with ",(0,i.jsx)(n.code,{children:"queueUrlMap"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"pgboss",children:"PGBoss"}),"\n",(0,i.jsx)(n.p,{children:"Create a typed PGBoss queue and subscribe using either method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { pgbossQueue } from 'balda';\n\ntype NotificationPayload = {\n  userId: string;\n  message: string;\n};\n\n// Create queue instance\nexport const notificationQueue = pgbossQueue<NotificationPayload>('notifications');\n\n// Subscribe with decorator\nexport class NotificationHandler {\n  @notificationQueue.subscribe()\n  async handle(payload: NotificationPayload) {\n    console.log(`Notifying user ${payload.userId}: ${payload.message}`);\n  }\n}\n\n// Or subscribe with callback\nawait notificationQueue.subscribe(async (payload) => {\n  console.log(`Notifying user ${payload.userId}: ${payload.message}`);\n});\n\n// Publish with PGBoss options\nawait notificationQueue.publish(\n  { userId: '123', message: 'Hello!' },\n  {\n    retryLimit: 3,\n    retryDelay: 60\n  }\n);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note: PgBoss automatically creates queues when needed. Ensure your PostgreSQL database is accessible and the ",(0,i.jsx)(n.code,{children:"pg-boss"})," package is installed."]}),"\n",(0,i.jsx)(n.h4,{id:"custom-provider",children:"Custom provider"}),"\n",(0,i.jsxs)(n.p,{children:["Implement the ",(0,i.jsx)(n.code,{children:"GenericPubSub"})," interface and create a typed queue using ",(0,i.jsx)(n.code,{children:"createQueue"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"import { createQueue, GenericPubSub } from 'balda';\n\ntype CustomPayload = {\n  data: string;\n};\n\n// Implement custom PubSub\nclass MyCustomPubSub implements GenericPubSub<CustomPayload> {\n  async publish(topic: string, payload: CustomPayload): Promise<{ id: string }> {\n    // Custom publish logic\n    console.log('Publishing to', topic, payload);\n    return { id: 'custom-id-1' };\n  }\n\n  async subscribe(topic: string, handler: (payload: CustomPayload) => Promise<void>): Promise<void> {\n    // Wire your consumer and call handler(payload)\n    console.log('Subscribed to', topic);\n  }\n}\n\n// Create typed queue with custom provider\nexport const customQueue = createQueue<CustomPayload>(\n  'custom-topic',\n  new MyCustomPubSub()\n);\n\n// Subscribe with decorator\nexport class CustomHandler {\n  @customQueue.subscribe()\n  async handle(payload: CustomPayload) {\n    console.log('Received:', payload.data);\n  }\n}\n\n// Or subscribe with callback\nawait customQueue.subscribe(async (payload) => {\n  console.log('Received:', payload.data);\n});\n\n// Publish\nawait customQueue.publish({ data: 'test' });\n"})}),"\n",(0,i.jsx)(n.p,{children:"The custom provider approach gives you full control over the queue implementation while maintaining type safety and a consistent API."})]})}function c(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>t});var o=s(6540);const i={},a=o.createContext(i);function r(e){const n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);