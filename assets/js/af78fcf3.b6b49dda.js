"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1935],{6261:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"queues/overview","title":"overview","description":"Queues Overview","source":"@site/docs/queues/overview.md","sourceDirName":"queues","slug":"/queues/overview","permalink":"/balda-js/docs/queues/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda-js/tree/main/docs/docs/queues/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Overview","permalink":"/balda-js/docs/cron/overview"},"next":{"title":"publishing","permalink":"/balda-js/docs/queues/publishing"}}');var i=n(4848),t=n(8453);const o={sidebar_position:1},c=void 0,l={},a=[{value:"Queues Overview",id:"queues-overview",level:3},{value:"Core building blocks",id:"core-building-blocks",level:4},{value:"Quick start from server instance",id:"quick-start-from-server-instance",level:4},{value:"Quick start without server instance",id:"quick-start-without-server-instance",level:4},{value:"Registration approaches",id:"registration-approaches",level:4}];function u(e){const s={code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h3,{id:"queues-overview",children:"Queues Overview"}),"\n",(0,i.jsx)(s.p,{children:"Balda.js provides a lightweight, provider-agnostic queue abstraction to publish and consume background jobs with a clean, type\u2011safe API. It ships with first\u2011class providers for BullMQ and AWS SQS, and allows custom providers."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Decorator-based consumers"}),": use ",(0,i.jsx)(s.code,{children:"@queue/"})," decorators to subscribe class methods to a topic."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Typed topics"}),": declare topics via module augmentation to get end\u2011to\u2011end type safety."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Simple publishing"}),": call ",(0,i.jsx)(s.code,{children:"publish(provider, topic, payload)"})," or shortcuts like ",(0,i.jsx)(s.code,{children:"publish.bullmq"}),"/",(0,i.jsx)(s.code,{children:"publish.sqs"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Autoload handlers"}),": import handlers with glob patterns and start subscribers via the ",(0,i.jsx)(s.code,{children:"Server"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"core-building-blocks",children:"Core building blocks"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"queue"})," decorator and shortcuts: ",(0,i.jsx)(s.code,{children:"queue.bullmq"}),", ",(0,i.jsx)(s.code,{children:"queue.sqs"}),", ",(0,i.jsx)(s.code,{children:"queue.pgboss"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"publish"})," function and shortcuts: ",(0,i.jsx)(s.code,{children:"publish.bullmq"}),", ",(0,i.jsx)(s.code,{children:"publish.sqs"}),", ",(0,i.jsx)(s.code,{children:"publish.pgboss"}),"."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"defineQueueConfiguration"})," single entrypoint to configure built-in and custom providers."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"QueueService"})," (optional) to register and start consumers manually without decorators."]}),"\n"]}),"\n",(0,i.jsx)(s.h4,{id:"quick-start-from-server-instance",children:"Quick start from server instance"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Define your topics once:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"declare module 'balda-js' {\n  export interface QueueTopic {\n    test: { name: string };\n  }\n}\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"2",children:["\n",(0,i.jsx)(s.li,{children:"Create handlers using decorators:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"import { queue } from 'balda-js';\n\nexport class MyHandler {\n  @queue.bullmq('test')\n  async handle(payload: { name: string }) {\n    // process job\n  }\n}\n"})}),"\n",(0,i.jsxs)(s.ol,{start:"3",children:["\n",(0,i.jsx)(s.li,{children:"Start subscribers and publish jobs:"}),"\n"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"import { Server, publish, defineQueueConfiguration } from 'balda-js';\n\ndefineQueueConfiguration({\n  bullmq: {\n    connection: { host: '127.0.0.1', username: 'default', password: 'root', db: 0 },\n  },\n});\n\nconst server = new Server({ port: 3000, host: '0.0.0.0' });\n\n// Entrypoint to start the registered queues\nawait server.startRegisteredQueues(['test/queue/schedules/**/*.ts'], () => {\n  console.log('Queues started');\n});\n\nawait publish.bullmq('test', { name: 'test' });\n"})}),"\n",(0,i.jsx)(s.p,{children:"Continue with configuration and publishing details in the next sections."}),"\n",(0,i.jsx)(s.h4,{id:"quick-start-without-server-instance",children:"Quick start without server instance"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// queue.ts\nimport { QueueService } from 'balda-js';\nimport path from 'node:path';\n\nQueueService.massiveImportQueues([path.join(import.meta.dirname, 'src/queues/**/*.ts')])\n  .then(() => {\n    QueueService.run().catch((error) => {\n      console.error('Error starting queues', error);\n    });\n  })\n  .catch((error) => {\n    console.error('Error importing queues', error);\n  });\n"})}),"\n",(0,i.jsx)(s.h4,{id:"registration-approaches",children:"Registration approaches"}),"\n",(0,i.jsx)(s.p,{children:"You can register consumers in two ways:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Decorators (recommended for most cases)"}),"\n",(0,i.jsx)(s.li,{children:"Static registration via the service class"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Static registration example:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"import { QueueService } from 'balda-js';\n\ndeclare module 'balda-js' {\n  export interface QueueTopic {\n    test: { name: string };\n  }\n}\n\nQueueService.register(\n  'PlainHandler.handle',\n  'test',\n  async (payload: { name: string }) => {\n    console.log('Received', payload.name);\n  },\n  { provider: 'bullmq' }\n);\n\n// Ensure this file is imported before starting subscribers, e.g. via the same glob patterns\n"})})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var r=n(6540);const i={},t=r.createContext(i);function o(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);