"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[492],{2318:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"testing/mock-server","title":"MockServer Testing","description":"The MockServer is Balda.js\'s powerful testing utility that allows you to test HTTP endpoints without starting a real server. This enables fast, isolated testing of your controllers and middleware.","source":"@site/docs/testing/mock-server.md","sourceDirName":"testing","slug":"/testing/mock-server","permalink":"/balda-js/docs/docs/testing/mock-server","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda-js/tree/main/docs/docs/testing/mock-server.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Testing Overview","permalink":"/balda-js/docs/docs/testing/overview"},"next":{"title":"Testing Examples","permalink":"/balda-js/docs/docs/testing/examples"}}');var r=n(4848),i=n(8453);const a={},o="MockServer Testing",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"HTTP Methods",id:"http-methods",level:2},{value:"GET Requests",id:"get-requests",level:3},{value:"POST Requests",id:"post-requests",level:3},{value:"Other HTTP Methods",id:"other-http-methods",level:3},{value:"Request Options",id:"request-options",level:2},{value:"Headers",id:"headers",level:3},{value:"Query Parameters",id:"query-parameters",level:3},{value:"Cookies",id:"cookies",level:3},{value:"IP Address",id:"ip-address",level:3},{value:"Response Assertions",id:"response-assertions",level:2},{value:"Status Code Assertions",id:"status-code-assertions",level:3},{value:"Body Assertions",id:"body-assertions",level:3},{value:"Complete Example",id:"complete-example",level:3},{value:"File Upload Testing",id:"file-upload-testing",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Test Isolation",id:"1-test-isolation",level:3},{value:"2. Descriptive Test Names",id:"2-descriptive-test-names",level:3},{value:"3. Use TypeScript",id:"3-use-typescript",level:3},{value:"4. Test Edge Cases",id:"4-test-edge-cases",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"Custom Request Configuration",id:"custom-request-configuration",level:3},{value:"Testing Middleware",id:"testing-middleware",level:3}];function d(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"mockserver-testing",children:"MockServer Testing"})}),"\n",(0,r.jsx)(s.p,{children:"The MockServer is Balda.js's powerful testing utility that allows you to test HTTP endpoints without starting a real server. This enables fast, isolated testing of your controllers and middleware."}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(s.p,{children:"MockServer simulates HTTP requests by:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Executing the complete middleware chain"}),"\n",(0,r.jsx)(s.li,{children:"Running route handlers with mocked request/response objects"}),"\n",(0,r.jsx)(s.li,{children:"Providing realistic testing environment without network overhead"}),"\n",(0,r.jsx)(s.li,{children:"Supporting all HTTP methods and content types"}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'import { describe, it, expect } from "vitest";\nimport { mockServer } from "test/server/instance";\n\ndescribe("API Tests", () => {\n  it("GET /users returns all users", async () => {\n    const res = await mockServer.get("/users");\n    expect(res.statusCode()).toBe(200);\n    expect(Array.isArray(res.body())).toBe(true);\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"http-methods",children:"HTTP Methods"}),"\n",(0,r.jsx)(s.p,{children:"MockServer provides methods for all HTTP verbs:"}),"\n",(0,r.jsx)(s.h3,{id:"get-requests",children:"GET Requests"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'// Simple GET request\nconst res = await mockServer.get("/users");\n\n// GET with query parameters\nconst res = await mockServer.get("/users", {\n  query: { page: "1", limit: "10" }\n});\n\n// GET with headers\nconst res = await mockServer.get("/users", {\n  headers: { "Authorization": "Bearer token123" }\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"post-requests",children:"POST Requests"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'// POST with JSON body\nconst res = await mockServer.post("/users", {\n  body: { name: "John", email: "john@example.com" }\n});\n\n// POST with form data\nconst res = await mockServer.post("/users", {\n  urlencoded: { name: "John", email: "john@example.com" }\n});\n\n// POST with file upload\nconst formData = new FormData();\nformData.append("file", new Blob(["content"]), "test.txt");\nconst res = await mockServer.post("/upload", { formData });\n'})}),"\n",(0,r.jsx)(s.h3,{id:"other-http-methods",children:"Other HTTP Methods"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'// PUT request\nconst res = await mockServer.put("/users/1", {\n  body: { name: "Updated Name" }\n});\n\n// PATCH request\nconst res = await mockServer.patch("/users/1", {\n  body: { name: "Patched Name" }\n});\n\n// DELETE request\nconst res = await mockServer.delete("/users/1");\n'})}),"\n",(0,r.jsx)(s.h2,{id:"request-options",children:"Request Options"}),"\n",(0,r.jsx)(s.p,{children:"MockServer supports comprehensive request configuration:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:"interface MockServerOptions {\n  headers?: Record<string, string>;\n  query?: Record<string, string>;\n  cookies?: Record<string, string>;\n  ip?: string;\n  body?: any;\n  formData?: FormData;\n  urlencoded?: Record<string, string>;\n}\n"})}),"\n",(0,r.jsx)(s.h3,{id:"headers",children:"Headers"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.get("/protected", {\n  headers: {\n    "Authorization": "Bearer token123",\n    "Content-Type": "application/json"\n  }\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"query-parameters",children:"Query Parameters"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.get("/search", {\n  query: {\n    q: "search term",\n    page: "1",\n    limit: "20"\n  }\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"cookies",children:"Cookies"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.get("/profile", {\n  cookies: {\n    sessionId: "abc123",\n    userId: "456"\n  }\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"ip-address",children:"IP Address"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.get("/location", {\n  ip: "192.168.1.1"\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"response-assertions",children:"Response Assertions"}),"\n",(0,r.jsx)(s.p,{children:"MockResponse provides powerful assertion methods:"}),"\n",(0,r.jsx)(s.h3,{id:"status-code-assertions",children:"Status Code Assertions"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.get("/users");\nexpect(res.statusCode()).toBe(200);\nexpect(res.assertStatus(200)); // Alternative syntax\n'})}),"\n",(0,r.jsx)(s.h3,{id:"body-assertions",children:"Body Assertions"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'// Exact body match\nexpect(res.assertBodyDeepEqual({ id: 1, name: "John" }));\n\n// Partial body match\nexpect(res.assertBodySubset({ name: "John" }));\n\n// Get body content\nconst body = res.body();\nexpect(body.name).toBe("John");\n'})}),"\n",(0,r.jsx)(s.h3,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'describe("User API", () => {\n  it("creates a new user", async () => {\n    const newUser = {\n      name: "Jane Doe",\n      email: "jane@example.com",\n      age: 25\n    };\n\n    const res = await mockServer.post("/users", { body: newUser });\n\n    expect(res.assertStatus(201));\n    expect(res.assertBodyDeepEqual(newUser));\n  });\n\n  it("returns 404 for non-existent user", async () => {\n    const res = await mockServer.get("/users/999");\n\n    expect(res.assertStatus(404));\n    expect(res.assertBodyDeepEqual({ error: "User not found" }));\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"file-upload-testing",children:"File Upload Testing"}),"\n",(0,r.jsx)(s.p,{children:"MockServer supports file upload testing with FormData:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'describe("File Upload", () => {\n  it("uploads a file successfully", async () => {\n    const formData = new FormData();\n    const fileContent = new Uint8Array([1, 2, 3, 4, 5]);\n    formData.append("file", new Blob([fileContent]), "test.txt");\n\n    const res = await mockServer.post("/upload", { formData });\n\n    expect(res.assertStatus(200));\n    expect(res.body()).toEqual({\n      originalName: "test.txt",\n      filename: "file",\n      size: 5,\n      mimetype: "application/octet-stream"\n    });\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(s.p,{children:"MockServer properly handles and reports errors:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'describe("Error Handling", () => {\n  it("handles server errors gracefully", async () => {\n    const res = await mockServer.get("/users", {\n      query: { shouldFail: "true" }\n    });\n\n    expect(res.assertStatus(500));\n    expect(res.body()).toHaveProperty("error");\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(s.h3,{id:"1-test-isolation",children:"1. Test Isolation"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'describe("User Management", () => {\n  // Each test should be independent\n  it("creates user", async () => {\n    // Test implementation\n  });\n\n  it("updates user", async () => {\n    // Test implementation - doesn\'t depend on previous test\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"2-descriptive-test-names",children:"2. Descriptive Test Names"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'// Good\nit("POST /users returns 409 when user already exists", async () => {\n  // Test implementation\n});\n\n// Avoid\nit("test user creation", async () => {\n  // Test implementation\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"3-use-typescript",children:"3. Use TypeScript"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'interface UserResponse {\n  id: number;\n  name: string;\n  email: string;\n}\n\nconst res = await mockServer.get<UserResponse[]>("/users");\nconst users = res.body() as UserResponse[];\n'})}),"\n",(0,r.jsx)(s.h3,{id:"4-test-edge-cases",children:"4. Test Edge Cases"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'describe("User Validation", () => {\n  it("rejects invalid email format", async () => {\n    const res = await mockServer.post("/users", {\n      body: { name: "John", email: "invalid-email" }\n    });\n\n    expect(res.assertStatus(400));\n  });\n\n  it("requires all mandatory fields", async () => {\n    const res = await mockServer.post("/users", {\n      body: { name: "John" } // Missing email\n    });\n\n    expect(res.assertStatus(400));\n  });\n});\n'})}),"\n",(0,r.jsx)(s.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,r.jsx)(s.h3,{id:"custom-request-configuration",children:"Custom Request Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-typescript",children:'const res = await mockServer.request("GET", "/api/data", {\n  headers: {\n    "X-Custom-Header": "value",\n    "Authorization": "Bearer token"\n  },\n  query: { filter: "active" },\n  cookies: { sessionId: "abc123" },\n  ip: "192.168.1.100"\n});\n'})}),"\n",(0,r.jsx)(s.h3,{id:"testing-middleware",children:"Testing Middleware"}),"\n",(0,r.jsx)(s.p,{children:"MockServer executes the complete middleware chain, allowing you to test:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"Authentication middleware"}),"\n",(0,r.jsx)(s.li,{children:"Rate limiting"}),"\n",(0,r.jsx)(s.li,{children:"CORS handling"}),"\n",(0,r.jsx)(s.li,{children:"Request logging"}),"\n",(0,r.jsx)(s.li,{children:"Custom business logic middleware"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"This comprehensive testing approach ensures your entire request pipeline works correctly in isolation."})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>a,x:()=>o});var t=n(6540);const r={},i=t.createContext(r);function a(e){const s=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);