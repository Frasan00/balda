"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5951],{2984:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"mqtt/overview","title":"MQTT Overview","description":"Balda provides a decorator-based MQTT client that lets you subscribe to MQTT topics and publish messages with full type safety. This feature is available in Node.js compatible environments.","source":"@site/docs/mqtt/overview.md","sourceDirName":"mqtt","slug":"/mqtt/overview","permalink":"/balda/docs/mqtt/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/Frasan00/balda/tree/main/docs/docs/mqtt/overview.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"providers","permalink":"/balda/docs/queues/providers"},"next":{"title":"Storage","permalink":"/balda/docs/storage/overview"}}');var t=r(4848),i=r(8453);const a={sidebar_position:1},l="MQTT Overview",o={},c=[{value:"Quick Start",id:"quick-start",level:2},{value:"1. Define Your Topics (Type Safety)",id:"1-define-your-topics-type-safety",level:3},{value:"2. Create Handlers with Decorators",id:"2-create-handlers-with-decorators",level:3},{value:"3. Connect to MQTT Broker",id:"3-connect-to-mqtt-broker",level:3},{value:"Key Features",id:"key-features",level:2},{value:"Message Parsing",id:"message-parsing",level:2},{value:"MQTT Wildcards",id:"mqtt-wildcards",level:2},{value:"Single-level wildcard (+)",id:"single-level-wildcard-",level:3},{value:"Multi-level wildcard (#)",id:"multi-level-wildcard-",level:3},{value:"Handler Signatures",id:"handler-signatures",level:2},{value:"Without topic parameter (recommended)",id:"without-topic-parameter-recommended",level:3},{value:"With topic parameter (useful for wildcards)",id:"with-topic-parameter-useful-for-wildcards",level:3},{value:"CLI Generator",id:"cli-generator",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Logger",id:"logger",level:2},{value:"Connection Options",id:"connection-options",level:2},{value:"Manual Import",id:"manual-import",level:2},{value:"Disconnecting",id:"disconnecting",level:2},{value:"Additional Resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"mqtt-overview",children:"MQTT Overview"})}),"\n",(0,t.jsxs)(n.p,{children:["Balda provides a ",(0,t.jsx)(n.strong,{children:"decorator-based MQTT client"})," that lets you subscribe to MQTT topics and publish messages with full type safety. This feature is available in ",(0,t.jsx)(n.strong,{children:"Node.js compatible environments"}),"."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Peer dependency"})," \u2014 Balda uses the community-standard ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/mqtt",children:(0,t.jsx)(n.code,{children:"mqtt"})})," package. To enable MQTT support you must install it yourself:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# with npm\nnpm install mqtt\n\n# or with yarn / pnpm / bun\nyarn add mqtt\npnpm add mqtt\nbun add mqtt\n"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.h3,{id:"1-define-your-topics-type-safety",children:"1. Define Your Topics (Type Safety)"}),"\n",(0,t.jsx)(n.p,{children:"Declare your MQTT topics once via module augmentation:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'declare module "balda" {\n  interface MqttTopics {\n    "home/temperature": { value: number; unit: string };\n    "home/humidity": { value: number };\n    "sensors/status": string;\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-create-handlers-with-decorators",children:"2. Create Handlers with Decorators"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { BaseMqtt, mqtt } from "balda";\n\nexport default class extends BaseMqtt {\n  @mqtt.subscribe("home/temperature")\n  async handleTemperature(message: { value: number; unit: string }) {\n    this.logger.info(`Temperature: ${message.value}${message.unit}`);\n\n    // Publish response\n    await mqtt.publish("home/ack", { received: true }, { qos: 1 });\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"3-connect-to-mqtt-broker",children:"3. Connect to MQTT Broker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { MqttService, setMqttGlobalErrorHandler } from "balda";\n\n// Optional: Set global error handler\nsetMqttGlobalErrorHandler((error: Error) => {\n  console.error("MQTT Error:", error);\n});\n\n// Import handlers\nawait MqttService.massiveImportMqttHandlers(["src/mqtt/**/*.ts"]);\n\n// Connect to MQTT broker and subscribe to all registered topics\nawait MqttService.connect({\n  host: "localhost",\n  port: 1883,\n  protocol: "mqtt",\n  username: "user",\n  password: "pass",\n});\n\nconsole.log("MQTT connected");\n'})}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83c\udfaf Type-safe"}),": Full TypeScript support with topic and message typing"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udd04 Auto-parsing"}),": Messages automatically parsed from Buffer \u2192 JSON \u2192 string"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83c\udfa8 Decorator-based"}),": Clean, intuitive API with ",(0,t.jsx)(n.code,{children:"@mqtt.subscribe()"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udce4 Easy publishing"}),": Simple ",(0,t.jsx)(n.code,{children:"mqtt.publish()"})," for sending messages"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udd0c Wildcard support"}),": Subscribe to multiple topics with ",(0,t.jsx)(n.code,{children:"+"})," and ",(0,t.jsx)(n.code,{children:"#"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u26a1 QoS levels"}),": Full support for QoS 0, 1, and 2"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\ud83d\udee1\ufe0f Error handling"}),": Built-in error handlers with custom override support"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"message-parsing",children:"Message Parsing"}),"\n",(0,t.jsx)(n.p,{children:"Messages are automatically parsed in this order:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"JSON object"})," \u2192 If valid JSON, returns parsed object"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"String"})," \u2192 If not JSON, returns as string"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Buffer"})," \u2192 Fallback to original Buffer"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('sensor/data')\nhandleData(message: { temp: number } | string) {\n  // message is automatically parsed based on content\n  if (typeof message === 'object') {\n    console.log('JSON:', message.temp);\n  } else {\n    console.log('String:', message);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"mqtt-wildcards",children:"MQTT Wildcards"}),"\n",(0,t.jsx)(n.p,{children:"Subscribe to multiple topics using MQTT wildcards:"}),"\n",(0,t.jsx)(n.h3,{id:"single-level-wildcard-",children:"Single-level wildcard (+)"}),"\n",(0,t.jsx)(n.p,{children:"Matches exactly one level:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('home/+/temperature')\nhandleRoomTemp(topic: string, message: string) {\n  const room = topic.split('/')[1]; // bedroom, kitchen, etc.\n  console.log(`${room}: ${message}`);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"multi-level-wildcard-",children:"Multi-level wildcard (#)"}),"\n",(0,t.jsx)(n.p,{children:"Matches any number of levels:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('sensors/#')\nhandleAllSensors(topic: string, message: string) {\n  // Matches: sensors/temp, sensors/room/temp, etc.\n  console.log(`Sensor ${topic}: ${message}`);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"handler-signatures",children:"Handler Signatures"}),"\n",(0,t.jsx)(n.p,{children:"Handlers can accept parameters in two ways:"}),"\n",(0,t.jsx)(n.h3,{id:"without-topic-parameter-recommended",children:"Without topic parameter (recommended)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('home/temperature')\nhandleTemperature(message: { value: number; unit: string }) {\n  // Topic is already known from decorator\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"with-topic-parameter-useful-for-wildcards",children:"With topic parameter (useful for wildcards)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('home/+/temperature')\nhandleRoomTemperature(topic: string, message: string) {\n  // Topic is included for dynamic routing\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"cli-generator",children:"CLI Generator"}),"\n",(0,t.jsx)(n.p,{children:"Generate MQTT handlers using the CLI:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx balda generate-mqtt -t home/temperature -p src/mqtt\n"})}),"\n",(0,t.jsx)(n.p,{children:"This creates a handler file with proper boilerplate:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { BaseMqtt, mqtt } from "balda";\n\ndeclare module "balda" {\n  interface MqttTopics {\n    "home/temperature": string;\n  }\n}\n\nexport default class extends BaseMqtt {\n  @mqtt.subscribe("home/temperature")\n  async handle(message: string) {\n    this.logger.info({ message }, "Message received");\n    // Implement your MQTT handler logic here\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(n.p,{children:"Set a custom global error handler for MQTT operations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { setMqttGlobalErrorHandler } from "balda";\n\nsetMqttGlobalErrorHandler((error: Error) => {\n  console.error("MQTT Error:", error);\n  // Send to Sentry, log to file, etc.\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Errors within handlers are automatically caught and logged:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"@mqtt.subscribe('sensor/data')\nasync handleSensorData(message: string) {\n  try {\n    const data = JSON.parse(message);\n    // Process data\n  } catch (error) {\n    this.logger.error('Failed to parse', error);\n    throw error; // Caught by global handler\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"logger",children:"Logger"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"BaseMqtt"})," class provides a scoped logger:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'export default class extends BaseMqtt {\n  @mqtt.subscribe("test/topic")\n  async handle(message: string) {\n    this.logger.info("Message received");\n    this.logger.debug("Raw message:", message);\n    this.logger.error("Something went wrong");\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"connection-options",children:"Connection Options"}),"\n",(0,t.jsx)(n.p,{children:"All MQTT.js connection options are supported:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { MqttService } from "balda";\n\nawait MqttService.connect({\n  host: "localhost",\n  port: 1883,\n  protocol: "mqtt", // or \'mqtts\', \'ws\', \'wss\'\n  username: "user",\n  password: "pass",\n  clientId: "my-client",\n  keepalive: 60,\n  clean: true,\n  reconnectPeriod: 1000,\n  connectTimeout: 30000,\n  will: {\n    topic: "status/offline",\n    payload: "Device disconnected",\n    qos: 1,\n    retain: true,\n  },\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"manual-import",children:"Manual Import"}),"\n",(0,t.jsx)(n.p,{children:"You can manually import handlers instead of using patterns:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { MqttService } from "balda";\nimport "./handlers/temperature.js";\nimport "./handlers/humidity.js";\n\nawait MqttService.connect({\n  host: "localhost",\n  port: 1883,\n});\n'})}),"\n",(0,t.jsx)(n.h2,{id:"disconnecting",children:"Disconnecting"}),"\n",(0,t.jsx)(n.p,{children:"The MQTT client automatically handles reconnection. To manually disconnect:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { MqttService } from "balda";\n\nawait MqttService.disconnect();\n'})}),"\n",(0,t.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,t.jsxs)(n.p,{children:["For more information about MQTT and the underlying library, see the ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/package/mqtt",children:"mqtt.js documentation"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var s=r(6540);const t={},i=s.createContext(t);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);